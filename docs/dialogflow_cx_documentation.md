# Google Cloud Dialogflow CX Documentation

## Table of Contents

1. [Generative vs Deterministic](#generative-vs-deterministic)
2. [Setup and Cleanup](#setup-and-cleanup)
3. [Build an Agent Using Playbooks](#build-an-agent-using-playbooks)
4. [Build an Agent Using Flows](#build-an-agent-using-flows)
5. [Create a Webhook](#create-a-webhook)
6. [Interactions with an Integration](#interactions-with-an-integration)
7. [Interactions with the API](#interactions-with-the-api)

---

## Generative vs Deterministic

During a conversation, Conversational Agents (Dialogflow CX) agents always use language models for understanding end-user intention, but you can choose whether and how language models are used for agent responses. You can decide between fully generative, partly generative, and deterministic features when designing your agent.

### Fully Generative

The fully generative features are built on [Vertex AI](https://cloud.google.com/vertex-ai/docs) large language models (LLMs) for both understanding end-user intention as well as generating agent responses. These features are easy to use and provide a very natural conversation.

#### Playbooks

[Playbooks](https://cloud.google.com/dialogflow/cx/docs/concept/playbook) provide a new way for creating virtual agents using LLMs. You only need to provide natural language instructions and structured data. This can significantly reduce the virtual agent creation and maintenance time, and enable brand new types of conversational experiences for your business.

#### Data Stores

[Data stores](https://cloud.google.com/dialogflow/cx/docs/concept/data-store) parse and comprehend your public or private content (website, internal documents, and so on). Once this information is indexed, your agent can answer questions and have conversations about the content. You just need to provide the content.

### Deterministic Flows

If you require more deterministic control over the conversation and all responses generated by the agent, you can design your agent with flows.

#### Flows

[Flows](https://cloud.google.com/dialogflow/cx/docs/basics) use language models for understanding end-user intention during a conversation, which may not be completely deterministic. However, once intention is established, you have complete control over the conversation flow and agent responses. Designing an agent with deterministic flows typically takes more design time, but this is a good option for agents that require explicit control over agent responses.

### Partly Generative Flows

Flows have some optional generative features that you can use when you don't need deterministic control over agent responses in certain conversation scenarios.

#### Generators

[Generators](https://cloud.google.com/dialogflow/cx/docs/concept/generative/generators) are used to generate agent responses. Rather than providing the agent response explicitly, you provide a LLM prompt that can handle many scenarios including conversation summarization, question answering, customer information retrieval, and escalation to a human.

#### Generative Fallback

[Generative fallback](https://cloud.google.com/dialogflow/cx/docs/concept/generative/generative-fallback) is used to generate agent responses when end-user input does not match an expected intention. You can enable generative fallback in certain scenarios by providing a LLM prompt to generate the response.

---

## Setup and Cleanup

This guide provides all required setup steps to start using Conversational Agents (Dialogflow CX). It also provides advice for possible cleanup steps after trying or testing Conversational Agents (Dialogflow CX).

### About the Google Cloud Console

The Google Cloud Console ([visit documentation](https://support.google.com/cloud/answer/3465889?hl=en&ref_topic=3340599), [open console](https://console.cloud.google.com/)) is a web UI used to provision, configure, manage, and monitor systems that use Google Cloud products. You use the Google Cloud Console to set up and manage Dialogflow resources.

### Create a Project

To use services provided by Google Cloud, you must create a _project_. A project organizes all your Google Cloud resources. A project consists of a set of collaborators, enabled APIs (and other resources), monitoring tools, billing information, and authentication and access controls.

**Roles required to select or create a project:**
- **Select a project**: Selecting a project doesn't require a specific IAM roleâ€”you can select any project that you've been granted a role on.
- **Create a project**: To create a project, you need the Project Creator (`roles/resourcemanager.projectCreator`), which contains the `resourcemanager.projects.create` permission.

[Go to project selector](https://console.cloud.google.com/projectselector2/home/dashboard)

### Enable Billing

A billing account is used to define who pays for a given set of resources, and it can be linked to one or more projects. Project usage is charged to the linked billing account.

[Verify that billing is enabled for your Google Cloud project](https://cloud.google.com/billing/docs/how-to/verify-billing-enabled#confirm_billing_is_enabled_on_a_project).

### Enable the API

You must enable the Dialogflow API for your project.

**Roles required to enable APIs:**
To enable APIs, you need the Service Usage Admin IAM role (`roles/serviceusage.serviceUsageAdmin`), which contains the `serviceusage.services.enable` permission.

[Enable the API](https://console.cloud.google.com/flows/enableapi?apiid=dialogflow.googleapis.com)

If you will be using [data store handlers](https://cloud.google.com/dialogflow/cx/docs/concept/data-store/handler), you must also [activate the AI Applications service](https://cloud.google.com/generative-ai-app-builder/docs/before-you-begin#turn-on-discovery-engine).

### Install and Initialize the Google Cloud CLI

If you plan to use the Dialogflow API, you need to install and initialize the [Google Cloud CLI](https://cloud.google.com/sdk/gcloud).

[Install](https://cloud.google.com/sdk/docs/install) the Google Cloud CLI. After installation, [initialize](https://cloud.google.com/sdk/docs/initializing) the Google Cloud CLI by running:

```bash
gcloud init
```

### Set up Authentication and Access Control

#### Authentication with User Accounts

**REST command line user account authentication:**
```bash
gcloud auth login
```

**Client library user account authentication:**
```bash
gcloud auth application-default login
gcloud auth application-default set-quota-project PROJECT_ID
```

#### Authentication with Service Accounts

Service accounts provide credentials for applications, as opposed to end-users. Service accounts are owned by projects, and you can create many service accounts for a project.

### Install the Conversational Agents (Dialogflow CX) Client Library

Client libraries are available for several popular languages. For installation instructions, see your desired language at [Client libraries](https://cloud.google.com/dialogflow/cx/docs/reference/library/overview).

### Cleanup

After setup and trying or testing Dialogflow, you may want to delete resources you created:

- You may want to [delete your agent](https://cloud.google.com/dialogflow/cx/docs/concept/agent#del).
- You may want to [shutdown your project](https://cloud.google.com/resource-manager/docs/creating-managing-projects#shutting_down_projects).
- If you called `gcloud auth login`, revoke credentials:
  ```bash
  gcloud auth revoke
  ```
- If you called `gcloud auth application-default login`, revoke credentials:
  ```bash
  gcloud auth application-default revoke
  ```

---

## Build an Agent Using Playbooks

This guide shows you how to build and test a simple shirt ordering agent using playbooks. When interacting with this agent, you can ask for the store location, get store hours, or make a shirt order.

### About Playbooks

An agent is composed of one or more playbooks. Each playbook has a clearly defined and limited scope. A playbook has the following data:

- **Name**: A name used to identify the playbook
- **Goal**: High level descriptions of what the playbook should accomplish
- **Instructions**: High level steps that should be taken to accomplish the playbook's goal
- **Examples**: Sample conversations between an end-user and the agent. These examples are effectively few-shot prompt examples for the LLM

### Create the Agent

1. Go to the Conversational Agents console: [Conversational Agents console](https://conversational-agents.cloud.google.com/)
2. If you haven't already, select or create a project
3. Click **Create agent**
4. Click **Build your own**
5. Provide "Shirt Ordering - Playbooks" for the agent name
6. Provide a [location](https://cloud.google.com/dialogflow/cx/docs/concept/region)
7. Provide a time zone
8. Provide a [default language](https://cloud.google.com/dialogflow/cx/docs/concept/agent-multilingual)
9. Select **Playbook** for the **Conversation start** option
10. Click **Create**

### Create the Order Playbook

The **Order** playbook handles shirt orders:

1. Click **Create**
2. Select the **Task playbook** option
3. Enter the playbook name: `Order`
4. Enter the following goal:
   ```
   You are a shirt store ordering assistant. Help customers purchase shirts.
   Help the customer choose a size and color.
   The shirts come in small, medium, and large.
   The shirts can be red, green, or blue.
   ```
5. Enter the following instructions:
   ```
   - If the customer has not provided a size, ask them to choose a size.
   - If the customer has not provided a color, ask them to choose a color.
   - Once the customer has selected a size and color for the shirt,
     repeat the selection to the customer, and ask them to confirm the selection.
   - Once the customer has confirmed their selection,
     let them know that the shirt is now ordered.
   - Do not provide prices or collect payment.
   - Do not collect the customer's name or address.
   ```

### Create the Information Playbook

The **Information** playbook handles questions about the store:

1. Click **Create**
2. Select the **Task playbook** option
3. Enter the playbook name: `Information`
4. Enter the following goal:
   ```
   You provide information about a shirt store.
   The store is open between 8 AM and 6 PM every day.
   The store is located at 1007 Mountain Drive, Gotham City, NJ.
   ```
5. Enter the following instructions:
   ```
   - If the customer asks for the store location, provide them with the address.
   - If the customer asks for the store hours, provide them with the hours.
   ```

### Update the Default Playbook

Update the default playbook to steer conversations to appropriate playbooks:

1. Click the default playbook (highlighted with a star)
2. Enter the following goal:
   ```
   You are an assistant for a shirt store.
   Your name is "Samantha".
   Your job is to direct customers to other playbooks based on the customer's questions.
   ```
3. Enter the following instructions:
   ```
   - If the customer hasn't been greeted yet, greet the customer,
     introduce yourself, and ask the user how you can help.
   - If the customer wants information about the store,
     route them to ${PLAYBOOK: Information}
   - If the customer wants to purchase a shirt,
     route them to ${PLAYBOOK: Order}
   ```

### Provide Examples

You can manually provide examples from the **Examples** tab when you have a playbook open. However, it is often easier to have a conversation with the functioning playbook and save the conversation as an example.

### Test the Agent

Your agent is now ready to test. Open the simulator panel and have a conversation with the agent.

---

## Build an Agent Using Flows

This guide shows you how to use the Dialogflow CX console to build and test a simple shirt ordering agent using flows. When interacting with this agent, you can ask for the store location, get store hours, or make a shirt order.

### Create an Agent

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Create or choose a project
3. Click **Create agent**
4. Select **Build your own**
5. Complete the form for basic agent settings:
   - Choose any display name
   - Select your preferred [location](https://cloud.google.com/dialogflow/cx/docs/how/region#avail)
   - Select your preferred time zone
   - Select the default language for your agent
   - Optionally enable Stackdriver logging
6. Click **Save**

### Default Flow and Intents

The following flow and intents are created automatically for a new agent:

- **Default Welcome Intent**: Has simple training phrases like "Hi" or "Hello" that are meant to match initial end-user input
- **Default Negative Intent**: Can be used to add training phrases that act as negative examples
- **Default Start Flow**: Can be used as your only flow. It has a default [intent route](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route) with the **Default Welcome Intent** as an intent requirement

### Store Location Page

#### Create the Location Intent

1. Select the **Manage** tab
2. Click **Intents**
3. Click **Create**
4. Enter `store.location` for the intent display name
5. Enter training phrases like:
   - "Where is the store?"
   - "Directions"
   - "Tell me the address"
   - "Where do I pick up my order?"
   - "How do I get there?"
   - "Where is the store located?"
   - "What street are you on?"
   - "What is your address?"
   - "How do I get to your store?"
   - "Where are you located?"

#### Create the Location Page

1. Click the **Build** tab
2. Select the **Default Start Flow** in the **Flows** section
3. Click the add button in the **Pages** section
4. Enter `Store Location` for the display name of the page
5. Click the options button next to the page display name
6. Select **Edit** to open the page editing panel
7. Find **Entry fulfillment** and click **Edit fulfillment**
8. Click **+Add dialogue response** to enter `Our store is located at 1007 Mountain Drive, Gotham City, NJ.` in the **Agent dialogue** field

#### Add a Location Intent Route to the Flow

1. Click the **Build** tab
2. Select the **Default Start Flow** in the **Flows** section
3. Click the **Start Page** node in the graph
4. Add the following intent route:
   - **Intent**: `store.location`
   - **Transition Page**: `Store Location`

### Order Item Page

#### Create a Custom Entity Type for Shirt Size

1. Select the **Manage** tab
2. Click **Entity Types**
3. Click **+Create**
4. Set the display name to `size`
5. Add entity entries:
   - small: small, tiny, little
   - medium: medium, regular, average
   - large: large, big, giant

#### Create an Order Intent with Intent Parameters

1. Select the **Manage** tab
2. Click **Intents**
3. Click **Create**
4. Enter `order.new` for the intent display name
5. Add training phrases and annotate them with parameters:
   - For phrases containing color, annotate with `color` parameter and `@sys.color` entity type
   - For phrases containing size, annotate with `size` parameter and `@size` custom entity type

#### Create an Order Page

1. Create a new page with display name: `New Order`
2. Add entry fulfillment: `Ok, let's start a new order.`
3. Add form parameters:
   - **color** (required): `@sys.color` entity type, prompt: "What color would you like?"
   - **size** (required): `@size` entity type, prompt: "What size do you want?"

#### Add Order Intent Route to the Flow

Add a route to the **Default Start Flow**:
- **Intent**: `order.new`
- **Transition Target page**: `New Order`

### Confirmation Page

Create a confirmation page that uses session parameters to confirm the order:
- Display name: `Order Confirmation`
- Entry fulfillment: `You can pick up your order for a $session.params.size $session.params.color shirt in 7 to 10 business days. Goodbye.`

---

## Create a Webhook

This guide shows you how to use a [webhook](https://cloud.google.com/dialogflow/cx/docs/concept/webhook), so your agent can be more dynamic. [Cloud Functions](https://cloud.google.com/functions/docs) are used to host the webhook due to their simplicity.

### Create the Cloud Function

1. Go to the [Cloud Functions overview page](https://console.cloud.google.com/functions/list)
2. Click **Create Function**, and set the following fields:
   - **Environment**: 1st gen
   - **Function name**: shirts-agent-webhook
   - **Region**: If you specified a region for your agent, use the same region
   - **HTTP Trigger type**: HTTP
   - **Authentication**: Require authentication
   - **Require HTTPS**: checked
3. Click **Save**
4. Set the following fields:
   - **Runtime**: Select the latest Go runtime
   - **Source code**: Inline Editor
   - **Entry point**: HandleWebhookRequest
5. Replace the code with the provided Go webhook implementation
6. Click **Deploy**

### Create the Webhook for Your Agent

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Select the **Manage** tab
5. Click **Webhooks**
6. Click **Create**
7. Complete the following fields:
   - **Display name**: shirts-agent-webhook
   - **Webhook URL**: Provide the webhook URL from the function
   - **Subtype**: Standard
8. Click **Save**

### Use the Webhook

1. Select the **Build** tab
2. Click the **Order Confirmation** page
3. Click the **Entry Fulfillment** field
4. Delete the existing text response
5. Click **Enable webhook**
6. Select the `shirts-agent-webhook` option from the **Webhook** dropdown
7. Enter `confirm` for the **Tag** field
8. Click **Save**

---

## Interactions with an Integration

With an [integration](https://cloud.google.com/dialogflow/cx/docs/concept/integration), end-user interactions are handled for you. You just need to build an agent, optionally implement a webhook, and configure the integration.

### Setup

To set up unauthenticated access to your Dialogflow CX Messenger agent:

1. Go to the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Select the **Manage** tab
5. Click **Integrations** in the left sidebar menu
6. Click **Connect** on **Dialogflow CX Messenger**
7. Select an **Environment**
8. Select **Unauthenticated API**
9. Select a style
10. Optionally restrict domain access
11. Click **Enable the unauthenticated API**
12. Copy the embeddable HTML code
13. Click **Done**

### Embed

Paste the embed code in a webpage on your website. The `<script>` and `<df-messenger>` HTML elements should be in the `<body>` element of your page.

Add the following to your `<head>` element for responsive layouts:
```html
<meta name="viewport" content="width=device-width, initial-scale=1">
```

### Customize

You can customize the appearance and behavior of this user interface in many ways. See the [Dialogflow CX Messenger documentation](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger) for more information.

---

## Interactions with the API

For each conversational turn, an _interaction_ takes place. During an interaction, an end-user sends input to Conversational Agents (Dialogflow CX), and Conversational Agents (Dialogflow CX) sends a response.

### Finding Required IDs

#### Dialogflow CX Console

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Select your Google Cloud project to open the agent selector
3. Click the option menu for an agent in the list
4. Click the copy name button
5. This copies the full identifying name of your agent in the form: `projects/PROJECT_ID/locations/REGION_ID/agents/AGENT_ID`

#### AI Applications Console

1. Go to the AI Applications console: [AI Applications console](https://console.cloud.google.com/gen-app-builder/)
2. Your project ID is shown at the top of the console
3. The **Location** column shows region IDs
4. Select an app
5. The browser URL path segment after `agents/` contains the agent app ID

### REST API Example

**HTTP method and URL:**
```
POST https://REGION_ID-dialogflow.googleapis.com/v3/projects/PROJECT_ID/locations/REGION_ID/agents/AGENT_ID/sessions/SESSION_ID:detectIntent
```

**Request JSON body:**
```json
{
  "queryInput": {
    "text": {
      "text": "END_USER_INPUT"
    },
    "languageCode": "en"
  },
  "queryParams": {
    "timeZone": "America/Los_Angeles"
  }
}
```

**curl command:**
```bash
curl -X POST \
     -H "Authorization: Bearer $(gcloud auth print-access-token)" \
     -H "x-goog-user-project: PROJECT_ID" \
     -H "Content-Type: application/json; charset=utf-8" \
     -d @request.json \
     "https://REGION_ID-dialogflow.googleapis.com/v3/projects/PROJECT_ID/locations/REGION_ID/agents/AGENT_ID/sessions/SESSION_ID:detectIntent"
```

**PowerShell command:**
```powershell
$cred = gcloud auth print-access-token
$headers = @{ "Authorization" = "Bearer $cred"; "x-goog-user-project" = "PROJECT_ID" }

Invoke-WebRequest `
    -Method POST `
    -Headers $headers `
    -ContentType: "application/json; charset=utf-8" `
    -InFile request.json `
    -Uri "https://REGION_ID-dialogflow.googleapis.com/v3/projects/PROJECT_ID/locations/REGION_ID/agents/AGENT_ID/sessions/SESSION_ID:detectIntent" | Select-Object -Expand Content
```

### Client Libraries

Client libraries are available for several programming languages including Java, Node.js, and Python. To authenticate to Dialogflow, set up Application Default Credentials. For more information, see [Set up authentication for a local development environment](https://cloud.google.com/docs/authentication/set-up-adc-local-dev-environment).

---

## Basic Concepts

### Important Terms

This guide lists terms that are important to understand, but are not necessarily associated with any resource.

#### Active

At any given moment during a conversation, one of the following is true:
- One and only one playbook is _active_.
- One and only one page and the associated flow are _active_.

#### Agent, Human Agent, Live Agent, Virtual Agent, Bot, and Chat Bot

In this documentation, without context, _agent_ refers to the virtual agent. When it is important to provide a distinction, a contact center may have both _human agents_ (also called _live agents_) and _virtual agents_.

_Virtual agent_, _bot_, and _chat bot_ are synonymous, however, _chat bot_ may imply a text-only interface in some contexts.

#### Audio Input, Speech Recognition, and Speech-to-Text

End-user input as an audio file or streamed audio sent at runtime to the agent API. Audio containing speech is transcribed by _speech recognition_ (_speech-to-text_) and the transcripts are processed.

#### Audio Output, Speech Synthesis, and Text-to-Speech

Agent output as an audio file or streamed audio sent at runtime to the agent's client. Agent text responses use _speech synthesis_ (_text-to-speech_) to convert text to audio.

#### Back-end and Front-end

_Back-end_ is the part of your system that is responsible for business logic. This is in contrast with the _front-end_, which provides a user interface.

#### Conversation and Session

End-user interaction with a virtual or human agent. _Conversation_ is synonymous with _session_.

#### Conversation Turn, End-user Input, and User Query

A _conversation turn_ is one interaction between an end-user and the virtual agent. The end-user provides an input (also called user query) and the agent provides a response.

#### Runtime and Design-time

When using the console or API to build an agent, this is a _design-time_ activity. When the agent is in a conversation with an end-user, this is a _runtime_ activity.

#### User, End-user, and Developer User

There are two types of users:
- _End-users_: People who have conversations with the agent.
- _Developer users_: Developers who build agents.

In this documentation, without context, _user_ and _end-user_ are equivalent.

### Conversational Agents Console Overview

The Conversational Agents console is a new console that includes features from both the Dialogflow CX console and the AI Applications console. All users of the AI Applications console should start using the Conversational Agents console. Users of the Dialogflow CX console that want to incorporate generative features into agents should start using the Conversational Agents console.

Using the Conversational Agents console, you can create interactive agents that use [generative playbooks](https://cloud.google.com/dialogflow/cx/docs/concept/playbook), [generative data stores](https://cloud.google.com/dialogflow/cx/docs/concept/data-store), and [deterministic flows](https://cloud.google.com/dialogflow/cx/docs/basics).

#### Console Compatibility

Agents previously built with the Dialogflow CX console or the AI Applications console can be seamlessly accessed by the Conversational Agents console. Agents created with any of these three consoles use the same Dialogflow API.

#### Supported Regions

This console supports all [regions](https://cloud.google.com/dialogflow/cx/docs/concept/region) already supported by the Dialogflow CX console or the AI Applications console.

#### Pricing

[Pricing](https://cloud.google.com/dialogflow/pricing) for agents created with the Conversational Agents console is the same as it has been for agents created with the Dialogflow CX console. Agents that utilize generative features such as playbooks, data stores, generators, or generative fallback for a request are charged as generative requests.

#### Create an Agent

**Prebuilt agents:**
1. Open the [Conversational Agents console](https://conversational-agents.cloud.google.com/).
2. If you haven't already, select or create a project.
3. Click **Create agent**.
4. Click **Use a prebuilt agent**.
5. Select a prebuilt agent and follow instructions for installation.

**Playbooks and/or flows:**
1. Open the [Conversational Agents console](https://conversational-agents.cloud.google.com/).
2. If you haven't already, select or create a project.
3. Click **Create agent**.
4. Click **Build your own**.
5. Provide an agent name, [location](https://cloud.google.com/dialogflow/cx/docs/concept/region), time zone, and [default language](https://cloud.google.com/dialogflow/cx/docs/concept/agent-multilingual).
6. Select a **Conversation start** option. If you want your agent to begin the conversation using a generative playbook, select **Playbook**. If you want your agent to begin the conversation using a deterministic flow, select **Flow**.
7. Click **Create**.

**Data store handlers:**
1. Open the [Conversational Agents console](https://conversational-agents.cloud.google.com/).
2. If you haven't already, select or create a project.
3. Click **Create agent**.
4. Click **Create a Q&A Agent**.
5. You are redirected to the AI Applications console. Follow the instructions to [create an agent](https://cloud.google.com/dialogflow/cx/docs/concept/data-store/handler#create-agent).

#### Top Row Navigation

The horizontal row at the top of the interface contains the following controls:

- **Project**: The currently selected [project](https://cloud.google.com/dialogflow/cx/docs/quick/setup#project)
- **Agent**: The currently selected [agent](https://cloud.google.com/dialogflow/cx/docs/concept/agent)
- **Language**: The currently selected [language](https://cloud.google.com/dialogflow/cx/docs/concept/agent-multilingual) used when entering language-specific data
- **Search**: Used to search, filter, and access core resources within the agent
- **Collaborators**: [Collaborators](https://cloud.google.com/dialogflow/cx/docs/concept/agent-collaboration) that have access to the agent
- **Export/Import agent**: Agent [export and import](https://cloud.google.com/dialogflow/cx/docs/concept/agent#export)
- **Change history**: Agent [change history](https://cloud.google.com/dialogflow/cx/docs/concept/change-history)
- **Settings**: Agent [settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings)
- **Publish agent**: A convenience button for setting up [Dialogflow CX Messenger](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger)
- **Simulator**: The [simulator](#simulator) used for testing the agent
- **Help**: Links to documentation and other help content
- **Feedback**: Used to provide product feedback

#### Left Navigation

- **Playbooks**: List, create, and edit generative [playbooks](https://cloud.google.com/dialogflow/cx/docs/concept/playbook)
- **Flows**: Visualize, create, and edit deterministic [flows](https://cloud.google.com/dialogflow/cx/docs/basics)
- **Tools**: List, create, and edit [playbook tools](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/tool)
- **Prebuilts**: Import ready to use prebuilt agents for a variety of common use cases
- **Test Cases**: List and define [test cases](https://cloud.google.com/dialogflow/cx/docs/concept/test-case) to regularly verify agent behavior
- **Conversation History**: View the [conversation history](https://cloud.google.com/dialogflow/cx/docs/concept/conversation-history)
- **Environments**: Create and edit various deployment [environments](https://cloud.google.com/dialogflow/cx/docs/concept/version)
- **Versions**: Snapshot flow and playbook [versions](https://cloud.google.com/dialogflow/cx/docs/concept/version)
- **Integrations**: [Integrate your agent](https://cloud.google.com/dialogflow/cx/docs/concept/integration) with ready to use user interfaces and other conversation platforms
- **Conversation Profiles**: List, create, and edit [conversational profiles](https://cloud.google.com/dialogflow/cx/docs/concept/conversation-profiles) for advanced telephony use cases

#### Simulator

The simulator is used to test your agent. You can have a conversation with your agent while monitoring changes in session state.

**Simulator settings:**
- [Agent environment](https://cloud.google.com/dialogflow/cx/docs/concept/version)
- Start resource, which can be a [playbook](https://cloud.google.com/dialogflow/cx/docs/concept/playbook) or [flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow) which receives the first input
- The generative model (start resource is a playbook) or a page (start resource is a flow)

**Simulator input:**
When interacting with the simulator, you provide end-user input as text or audio from your microphone, then press enter or click the send button.

In addition to plain text, you can choose alternate input types by typing `@`, then selecting the option:
- **Channel**: Send a [channel](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment#channel-specific) value as a query parameter
- **DTMF**: Send dual-tone multi-frequency signaling (Touch-Tone) input for telephony interactions
- **End user metadata**: Provide contextual hint in the form of a JSON object for generative AI to better answer an end-user query
- **Event**: Invoke an [event](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event)
- **Cloud Storage uri**: Cloud Storage URI for a file to upload. You can use this file for images and documents that provide context to the generative AI
- **Parameter**: Inject a [parameter](https://cloud.google.com/dialogflow/cx/docs/concept/parameter) value. You can provide new parameters or provide preset values for existing parameters
- **Parameter scope**: Set the [parameter scope](https://cloud.google.com/dialogflow/cx/docs/concept/handler#scope)

**Simulator controls:**
- **Debug trace**
- **Original response**
- **Show latency**
- **Create test case**
- **Undo**
- **Replay conversation**
- **Reset conversation**
- **Options**: Enable or disable webhook calls, partial responses, and sentiment analysis
- **Save as example**: [See instructions](https://cloud.google.com/dialogflow/cx/docs/quick/build-agent-playbook#provide_examples)

### Dialogflow CX Console Overview

Conversational Agents (Dialogflow CX) provides a web user interface called the Dialogflow CX console ([visit documentation](https://cloud.google.com/dialogflow/cx/docs/concept/console), [open console](https://dialogflow.cloud.google.com/cx/projects)). You use this console to create, build, and test agents. It graphs each flow as a conversational state machine diagram, which makes complex agents easy to design and understand.

The Dialogflow CX console is different from the Google Cloud Console. The Dialogflow CX console is used to manage Conversational Agents (Dialogflow CX) agents, while the Google Cloud Console is used to manage Google Cloud-specific Conversational Agents (Dialogflow CX) settings (for example, billing) and other Google Cloud resources.

#### How the Console is Used

The console is used to create, build, manage, fine-tune, and test your projects and agents. With it, you can:
- Create [projects](https://cloud.google.com/dialogflow/cx/docs/quick/setup#project)
- Create [agents](https://cloud.google.com/dialogflow/cx/docs/concept/agent) that contain all settings and data that define the conversational experience
- Create [flows](https://cloud.google.com/dialogflow/cx/docs/concept/flow) and [pages](https://cloud.google.com/dialogflow/cx/docs/concept/page) that are the building blocks for conversation control
- Create [entities](https://cloud.google.com/dialogflow/cx/docs/concept/entity) to extract useful data from end-user input
- Create [intents](https://cloud.google.com/dialogflow/cx/docs/concept/intent) that categorize end-user input
- Test your agent via the [simulator](#simulator)
- And more...

#### Project Selector

When you initially load the console, you must select a [project](https://cloud.google.com/dialogflow/cx/docs/quick/setup#project). The project selector interface is used to:
- Select pre-existing projects
- Create new projects

#### Agent Selector

Once you select a project, you must select an agent. The agent selector interface is used to:
- Select existing agents
- [Create new agents](https://cloud.google.com/dialogflow/cx/docs/concept/agent#create)
- [Create prebuilt agents](https://cloud.google.com/dialogflow/cx/docs/concept/agents-prebuilt)
- [Export and restore agents](https://cloud.google.com/dialogflow/cx/docs/concept/agent#export)
- [Delete agents](https://cloud.google.com/dialogflow/cx/docs/concept/agent#del)
- Configure [location settings](https://cloud.google.com/dialogflow/cx/docs/concept/region#location-settings)
- Filter agents by location

#### Agent Builder

Once a project and agent has been selected, the agent builder loads. The builder is arranged in the following panels:

**Project and agent selection**: You can use these menus to change the project, agent, or currently active language for [multilingual agents](https://cloud.google.com/dialogflow/cx/docs/concept/agent-multilingual).

**Search bar and task indicator**: Use the [search bar](https://cloud.google.com/dialogflow/cx/docs/concept/search) to search, filter, and access the core resources within the agent. The task indicator shows the status of tasks like training.

**Build and Manage tabs**: The **Build** tab contains sections for managing flows and pages. When you select a flow in the flow section, the pages contained within the flow are listed in the pages section. The **Manage** tab contains resources and tools available to the agent: intents, entity types, webhooks, etc.

**Graph settings**: These buttons provide various controls for viewing and interacting with the agent graph.

**Agent settings and simulator buttons**: The **Agent Settings** button opens the agent settings panel. The **Test Agent** button opens the [simulator](#simulator) panel.

**Graph**: The graph shows a visual representation of the selected flow, similar to a state machine diagram. Each node of the graph represents a page or flow start page. You can click a node to expand or contract it. When expanded, you can edit a nodes data.

The first node of the graph, called **Start**, is the start page of the flow.

Connecting lines from one node to another represent possible [transitions](https://cloud.google.com/dialogflow/cx/docs/concept/handler). They are color-coded in the following way:
- Blue represents transitions defined for intent requirements or for intent and condition requirements
- Orange represents transitions defined for condition requirements only
- Cyan represents transitions defined for [event handlers](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event)
- Grey represents transitions other than described above (for example, a mixture of the above mentioned transition types)

When a transition can lead to another flow, the target flow is shown as a node.

**Editing and simulator panels**: When editing agent content or testing the agent with the [simulator](#simulator), content-specific panels open on the right side of the console. These panels can be expanded to fill available console area, contracted to fill a portion of the right side of the console, or closed when you are finished.

#### Simulator

The simulator is used to test your agent. You can have a conversation with your agent while monitoring changes in session state.

**Simulator settings**: When you first open the simulator, you need to select an [agent environment or flow versions](https://cloud.google.com/dialogflow/cx/docs/concept/version) and an active [flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow). In most cases, you should use the draft environment and default start flow.

From buttons above the simulator, you can also:
- Enable or disable [webhook](https://cloud.google.com/dialogflow/cx/docs/concept/webhook) calls at any time with the webhook toggle button
- Enable or disable [partial responses](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment#partial-response)
- Enable or disable [sentiment analysis](https://cloud.google.com/dialogflow/cx/docs/concept/sentiment)

**Simulator input**: When interacting with the simulator, you provide end-user input as text, then press enter or click the send button. In addition to plain text, you can choose alternate input types with the input selector:
- **Parameter**: Inject a [parameter](https://cloud.google.com/dialogflow/cx/docs/concept/parameter) value. You can provide new parameters or provide preset values for existing parameters
- **Event**: Invoke an [event](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event)
- **DTMF**: Send dual-tone multi-frequency signaling (Touch-Tone) input for telephony interactions

**Simulator session state**: When using the simulator to have a conversation with your agent, session state is shown to the left of the conversation. The currently active flow, currently active page, populated parameter values, and [execution steps](https://cloud.google.com/dialogflow/cx/docs/concept/page#visualization) are shown. This information may help you debug an agent or verify its behavior in certain conversation scenarios.

**Simulator limitations**: For the simulator, the following limitations apply:
- You cannot set a parameter value to null
- Conversations created using simulator are inaccessible using API methods

### Agents

A _Conversational Agents (Dialogflow CX) agent_ is a virtual agent that handles concurrent conversations with your end-users. It is a natural language understanding module that understands the nuances of human language. Conversational Agents (Dialogflow CX) translates end-user text or audio during a conversation to structured data that your apps and services can understand. You design and build a Conversational Agents (Dialogflow CX) agent to handle the types of conversations required for your system.

A Conversational Agents (Dialogflow CX) agent is similar to a human call center agent. You train them both to handle expected conversation scenarios, and your training does not need to be overly explicit.

#### Create an Agent

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Create or choose a Google Cloud project
3. Click **Create agent**
4. Select **Auto-generate** to create a [data store agent](https://cloud.google.com/dialogflow/cx/docs/concept/data-store-agent) or select **Build your own** to create other kinds of agents
5. Complete the form for basic agent settings:
   - You can choose any display name
   - Select your preferred [location](https://cloud.google.com/dialogflow/cx/docs/how/region#avail)
   - Select your preferred time zone
   - Select the default language for your agent. You cannot change the default language for an agent once it is created
6. Click **Save**

**API:**
If you have not already configured [location settings](https://cloud.google.com/dialogflow/cx/docs/concept/region#location-settings) for your project, you must configure these settings with the console before creating agents with the API. Currently, you cannot configure location settings with the API.

To create an agent, see the `create` method for the `Agent` type.

#### Agent Data

Conversational Agents (Dialogflow CX) agents serve as top-level containers for settings and data for virtual agents. The following data is associated with agents:
- [Intents](https://cloud.google.com/dialogflow/cx/docs/concept/intent)
- [Entity types](https://cloud.google.com/dialogflow/cx/docs/concept/entity)
- [Webhooks](https://cloud.google.com/dialogflow/cx/docs/concept/webhook)
- [Flows](https://cloud.google.com/dialogflow/cx/docs/concept/flow)
- [Pages](https://cloud.google.com/dialogflow/cx/docs/concept/page)
- [Route groups](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route-group)

#### Export and Restore an Agent

You can export an agent to a file, and restore an agent with that file.

An agent export includes all agent data except the following:
- [Flow versions](https://cloud.google.com/dialogflow/cx/docs/concept/version): Only the draft flows are exported to file
- [Environments](https://cloud.google.com/dialogflow/cx/docs/concept/version): Custom environments are not exported to file

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose the Google Cloud project for the agent
3. Click the option menu for an agent in the list
4. Click the **Export** or **Restore** button
5. Follow instructions to complete

**API:**
See the `export` and `restore` methods for the `Agent` type.

#### Delete an Agent

In order to delete an agent, you need a role that provides full access or edit access. See the [access control guide](https://cloud.google.com/dialogflow/cx/docs/concept/access-control) for more information.

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose the Google Cloud project for the agent
3. Click the option menu for an agent in the list
4. Click the delete button
5. Confirm deletion in the dialog

**API:**
See the `delete` method for the `Agent` type.

### Prebuilt Agents

Prebuilt agents are a collection of agents provided by Conversational Agents (Dialogflow CX) for common use cases. These agents can be used to establish a base for building conversations. In Conversational Agents (Dialogflow CX), you will find popular use cases across industries, such as telecommunications, financial services, healthcare, retail, and travel. [Generative prebuilt agents](https://cloud.google.com/dialogflow/cx/docs/concept/generative/prebuilt-agent) are also available with limited access, demonstrating common use cases implemented using [generative features](https://cloud.google.com/dialogflow/cx/docs/concept/generative).

Prebuilt agents include [intents](https://cloud.google.com/dialogflow/cx/docs/concept/intent) and [entities](https://cloud.google.com/dialogflow/cx/docs/concept/entity) for their use cases, but you need to modify the example [route groups](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route-group) and [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) (where applicable).

#### Limitations

The following limitations apply:
- Prebuilt agents currently only support English (en)

#### Import a Prebuilt Agent

To import a prebuilt agent to your project:

1. Go to the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Click the project where you would like to import the prebuilt agent
3. Click **Use pre-built agents**
4. Click the agent of interest and click **Import**
5. Choose your desired [location](https://cloud.google.com/dialogflow/cx/docs/concept/region#avail) and click **Create**
6. Start testing and customizing

#### Customize the Imported Prebuilt Agent

1. [Test the agent](https://cloud.google.com/dialogflow/cx/docs/concept/console#simulator) using the simulator to understand what it can help users accomplish
2. Click the **Manage** tab in the left pane and then **Test Cases** to see coverage and example scripts
3. [Delete any flows](https://cloud.google.com/dialogflow/cx/docs/concept/flow#delete) that are irrelevant to your use case
4. Edit agent dialogue and [custom entities](https://cloud.google.com/dialogflow/cx/docs/concept/entity-custom) to meet your business needs
5. If there is [webhook source code](https://cloud.google.com/dialogflow/cx/docs/concept/webhook), see [Modifying webhook code](#modify-webhook)

#### Available Prebuilt Agents

**Financial Services Agent**
This template helps end-users with their cards, checks an application status, and investigates suspicious charges.

Sample utterances:
- "I'd like to make a payment towards my balance."
- "I lost my card and need a new one."
- "I want to report some suspicious activity on my checking account."
- "What is my auto loan application status?"
- "What are the different annual fees on your business credit cards?"

**Healthcare Agent**
This template helps end-users check their claims, benefits, and find a doctor.

Sample utterances:
- "What is coinsurance?"
- "Can you help me find a doctor?"
- "I'm not feeling well."
- "What is my deductible?"

**Order and Account Management Agent**
This template helps end-users purchase or return a product, track orders, and manage account settings, such as loyalty points, addresses, and passwords.

Sample utterances:
- "I haven't received my order, where is it?"
- "I want to get a new phone."
- "I forgot my password."
- "Can you tell me how many points I have?"
- "I moved and need to update my address."

**Payment Arrangement Agent**
This template helps end-users set up a two installment payment arrangement or extend a payment due date.

Sample utterances:
- "My account was suspended."
- "I won't get paid on time to pay my bill."
- "I need to extend my due date."
- "I lost my job due to covid-19."

**Small Talk Agent**
This template helps customize and personalize agents with simple questions.

Sample utterances:
- "What's up?"
- "Who are you?"
- "Today is my birthday."
- "Sorry."
- "What do you mean?"

**Telecommunications Agent**
This template helps end-users resolve billing and plan questions, troubleshoot, and add travel and cruise plans.

Sample utterances:
- "How can I save money on my bill?"
- "My texts aren't going through."
- "How much more will I pay if I upgrade to Plan A?"
- "I need data coverage for a trip I'm going on to Jamaica."

---

## Playbook Concepts

### Playbooks

A playbook is the basic building block of generative agents. A generative agent typically has many playbooks, where each playbook is defined to handle specific tasks. The playbook data is provided to the LLM, so it has the information it needs to answer questions and execute tasks. Each playbook can provide information, send queries to external services, or defer conversation handling to a [flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow) or another playbook to handle sub-tasks.

#### Limitations

The following limitations apply:
- Agents that use playbooks don't support sending a [call companion](https://cloud.google.com/dialogflow/cx/docs/concept/call-companion) SMS from the Default Welcome Intent route in the Default Start Flow, but you can enable the call companion SMS option in standard flows
- Playbooks do not support DTMF input from telephone systems

#### Language Support

See the **Playbooks** column in the [language reference](https://cloud.google.com/dialogflow/cx/docs/reference/language#table). The languages marked for playbooks have been tested for quality with `gemini-2.0-flash` and `gemini-1.5-flash-002` models.

When using languages other than English:
- In most cases, use English for playbook instructions. For certain languages and use cases, you may get slightly better responses if you additionally supply instructions in the target language
- Declare your language support in the playbook instructions. For example: "Always answer using the French language"
- Define your examples in the target language

#### Model Support

You can select the LLM model used in playbook in the following places:

**Agent level:**
- In Conversational Agents Console Agent setting -> Generative AI -> Playbook, select model by display name from the drop-down of all available models
- Specify the model name in the GenerativeSettings.llm_model_settings.model field if you use API to update agent setting

**Request level:**
- In the Conversational Agent Console simulator, select model by display name from drop-down when testing a playbook
- Specify the model name in DetectIntentRequest.query_params.llm_model_settings.model field if you are testing agent via API

**Available Models:**
- gemini-2.5-flash (GA)
- gemini-2.5-flash-lite (GA)
- gemini-2.0-flash-001 (GA)
- gemini-2.0-flash-lite-001 (GA)
- gemini-1.5-flash-002 (Legacy)

#### Region Support

Playbooks are supported in the following [regions](https://cloud.google.com/about/locations):
- `global`
- `asia-south1`, `asia-southeast1`, `asia-southeast2`, `asia-northeast1`
- `australia-southeast1`
- `eu` (multi-region)
- `europe-west1`, `europe-west2`, `europe-west3`, `europe-west4`, `europe-west6`
- `northamerica-northeast1`
- `us` (multi-region)
- `us-central1`, `us-east1`, `us-west1`

#### Playbook Data

A playbook is composed of the following data:
- **Playbook name**: a concise name in natural language that helps developers and the LLM to understand what tasks the playbook handles
- **Goals**: high level description of what the playbook should accomplish
- **Instructions**: defines the process steps that should be taken to accomplish the goal
- **Examples**: sample conversations that are effectively few-shot prompt examples for the LLM
- **Parameters**: are used to store information about a conversation like user input, user system information, results of actions, and so on

#### Playbook Types

When you create a playbook, you select the type of playbook you want: task playbook or routine playbook.

**Task Playbooks:**
- Used to break down complex tasks into smaller, reusable sub-tasks
- Used for modeling _compositional_ conversation stages, where each stage communicates through input and output parameters
- Any routine or task playbook can call another task playbook, but a task playbook cannot call another routine playbook

**Routine Playbooks:**
- Used for modeling _sequential_ conversation stages, where each stage is complete and independent
- Can call task playbooks to decompose larger tasks into smaller sub-tasks
- Can transition to other routine playbooks or flows
- Use session storage for parameters, which creates a more reliable context
- Each routine playbook in a series of transitions occurs within a single conversational turn, so there is only a single LLM call and improved latency

**Default Playbook:**
When you create a generative agent using Conversational Agents console, a **Default Generative Playbook** is created automatically. The default playbook is the starting point for conversations, so it has some important distinctions from other playbooks:
- The default playbook doesn't receive a summary of preceding conversation turns
- The default playbook can't define or receive input parameters

#### Create a Playbook

1. Click the playbook icon in the left navigation of the console
2. Click the **Create new** button
3. Select either **Routine** or **Task** playbook type
4. Provide playbook data

**Use AI generation to create a playbook:**
When creating a playbook, a generative AI panel opens. You can use this to generate playbook data for you.

#### Import and Export Playbooks

**Export a playbook:**
1. Navigate to the playbooks list
2. Click the export button for the playbook you want to export
3. Select exporting options
4. Click **Export**

**Import a playbook:**
1. Navigate to the playbooks list
2. Click **Import**
3. Select import options
4. Click **Import**

### Playbook Goals

A **goal** is a high level description of what the playbook should accomplish.

**Example:**
```
Help customers to book flights and hotels.
```

You can instruct the playbook to provide responses as tables and images. For example:
```
You're a helpful assistant that uses your knowledge to generate code,
compare products, find images, or other. Return your responses in
markdown format.
```

With that goal, end-users can query your playbook with questions like:
- Compare Google Pixel 7 versus Google Pixel 8 in a table
- Find a picture of two people high fiving

### Playbook Instructions

Playbook **instructions** define the process that should be taken to accomplish the playbook goal.

Each step contains a natural language instruction that may contain any of the following:
- A basic instruction that the LLM can understand
- An instruction to route the user to another playbook. Playbooks are referenced using the form `${PLAYBOOK: playbook_name}`
- An instruction to use a specific [playbook tool](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/tool). Tools are referenced using the form `${TOOL: tool_name}`
- An instruction to route the user to a [flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow). Flows are referenced using the form `${FLOW: flow_name}`
- A reference to a [playbook parameter](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/parameter). Parameters are referenced using the form `$parameter_name`
- An instruction to call a [code block](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/code-block). Code blocks are referenced using the form `` `function_name` ``

Each step description starts with `-` and an optional [numbered step](#steps), and you can define subinstructions using indentation.

**Sample:**
```
- greet the customer and ask them how you can help.
    - If the customer wants to book flights, route them to ${PLAYBOOK: flight_booking}.
    - If the customer wants to book hotels, route them to  ${PLAYBOOK: hotel_booking}.
    - If the customer wants to know trending attractions, use the ${TOOL: attraction_tool} to show them the list.
- help the customer to pay for their booking by routing them to ${FLOW: make_payment}.
```

#### Instruction Steps

To add structure to your instructions, you can optionally define steps with a hierarchical numbering system. If you do not provide step numbers, and a code block references a particular step, the ordering of steps will be used to determine step position values.

### Code Blocks

When defining a playbook, you can optionally provide _code blocks_, which are inline Python code that can be used to better control agent behavior. This code is made up of functions with special decorators and whatever utility functions you require.

#### Known Issues

The following known issues apply:
- Projects in VPC-SC perimeters that restrict Artifact Registry access will also reject Code Block deployments

#### Limitations

The following limitations apply:
- Code blocks cannot contain any objects that persist data. However, you can use tools to persist data and maintain state
- Code blocks cannot make remote calls directly. For example, you cannot use the Python requests library. However, you can utilize tools to make remote calls indirectly
- Resource names that are converted to Python names [must be legal Python names](https://cloud.google.com/dialogflow/cx/docs/reference/code-block-system-library#naming)
- Code blocks cannot write session parameters, unless a flow transition takes place

#### Inline Actions

Inline actions behave similar to [tool actions](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/example#tool-use). They have a defined input and output schema, which is determined by the Python function signature, including type annotations and docstring.

**Sample:**
```python
@Action
def is_prime(n: int): bool
  """Returns true if n is prime."""
  import math
  return (all([False for i in range(2, math.sqrt(n)
               if n % i == 0 ]) and not n < 2)
```

#### Trigger Functions

Trigger functions are used to define [conditional actions](https://cloud.google.com/dialogflow/cx/docs/concept/playbook/conditional-actions) in code.

**Available decorators:**
- `@EventTrigger(event: str, condition: str)` - Triggered by an event
- `@BeforeModelTrigger(condition: str)` - Triggered every time before the LLM predicts the next action
- `@BeforeActionTrigger(condition: str)` - Triggered every time before the LLM executes an action
- `@BeforePlaybookTrigger(condition: str)` - Triggered the first time a playbook is started

#### Action Overrides

You can use code blocks to create a queue of actions that will take place before any further actions determined by the LLM, and potentially override them. You create action overrides by using the `add_override` global function.

**Function arguments:**
- action: The action to take place. For an inline action, use `my_function_name`. For a tool action, use `tools.my_tool_name.my_tool_action`. For a flow action, use `flows.my_flow_name`
- inputs: Optional inputs for the action. For example: `{"location": "Omaha"}`

#### Response Overrides

Similar to action overrides, but specifically for agent responses, you can use the `respond` global function to force the agent to respond to the user with specific content.

**Sample:**
```python
respond("Hello")
```

### Playbook Conditional Actions

By default, playbooks use LLMs to control the conversation, take actions, and respond to end-users. If you need more explicit control over the agent's behavior, you can use [flows](https://cloud.google.com/dialogflow/cx/docs/concept/flow) or _conditional actions_.

Conditional actions are an optional configuration for playbooks. You can set conversation triggers and conditions that invoke specific actions like responding with a specific message, calling an external tool, invoking another playbook, or performing any other specified action.

#### Triggers

You can define triggers that are the first step in determining whether a conditional action is applicable:

**Lifecycle stage:**
- **Playbook start**: Triggered the first time a playbook is started
- **Before the LLM decides its next action**: Triggered every time before the LLM predicts the next action
- **Before the LLM executes its next action**: Triggered every time before the LLM executes an action

**Event:**
- **Custom event**
- **No input from user**

#### Conditions

Once a trigger occurs, the second step is to evaluate any optionally supplied conditions. Conditions are supplied using the same [condition syntax](https://cloud.google.com/dialogflow/cx/docs/reference/condition) used by flow routes.

You can use the following syntax to reference parameters and last/next actions:
- Session parameters: `$session.params.PARAMETER_NAME`
- Playbook input parameters: `$playbook.input.INPUT_FIELD_NAME`
- Last action: `$last-action.name`, `$last-action.input.INPUT_FIELD_NAME`, `$last-action.output.OUTPUT_FIELD_NAME`, `$last-action.status`
- Next action: `$next-action.name`, `$next-action.input.INPUT_FIELD_NAME`

#### Actions

Once a trigger and optional condition evaluation have occurred, you can configure the following actions to take place:
- **Provide a response to the end-user**: text, conditional response, custom payload, and pre-recorded audio
- **Override the next LLM action**: tool use, playbook invocation, playbook completion, flow invocation, playbook transition, flow transition
- **Change speech settings**: model name, no speech timeout, endpointer sensitivity, adaptation
- **Enable barge-in**
- **Allow cancellation of partial response playback**
- **Send Call Companion SMS**
- **Enable DTMF**: see [DTMF for telephony integrations](https://cloud.google.com/dialogflow/cx/docs/concept/dtmf)

### Playbook Examples

Each playbook should have one or more examples. These examples are sample conversations between an end-user and the playbook, including the dialogue and actions performed by the agent. These are effectively [few-shot prompt examples](https://cloud.google.com/vertex-ai/generative-ai/docs/learn/prompts/few-shot-examples) for the LLM.

#### Multilingual Agents

If you want your agent to handle multiple languages, your examples should use each of the languages.

#### Example Input Summary and Output Summary

In addition to input and output parameters, playbooks support receiving an **input summary** and emitting an **output summary** for exchanging information with other playbooks. Summaries are helpful for passing abstract contextual information between playbooks, while parameters are more helpful for passing structured, well defined fields between playbooks.

#### Example State

At a given point in the conversation, a playbook will be in one of the following states:
- `OK`: The playbook successfully achieved its goal and control will now transfer to the parent playbook
- `CANCELLED`: The user decided not to proceed with the goal assigned to the playbook
- `FAILED`: The playbook cannot proceed with the goal due to some error
- `ESCALATED`: The playbook decided that it cannot achieve the goal and needs to escalate the situation to a human
- `PENDING`: The conversation is still continuing within the playbook

#### Selection Strategy

The selection strategy setting controls whether an example is included in the playbook's prompt sent to the LLM:
- **Dynamically select**: The example is conditionally included, based on how relevant it is for the current conversation context
- **Always select**: The example is always included, regardless of the conversation context
- **Never select**: The example is never included in the prompt

#### Add Action

An example provided within a playbook consists of a series of actions. These actions may vary in their combinations, but they primarily depict the interaction between the user and the playbook, along with the actions taken in between to fulfill the user's query or requirements.

**Supported action types:**
- **Playbook response**: The playbook response to the user query
- **User input**: The user query
- **Tool use**: A [tool](https://cloud.google.com/dialogflow/vertex/docs/concept/tools) invocation to get additional information needed to fulfill the user's query
- **Playbook invocation**: When the playbook should invoke another task playbook to fulfill the user query
- **Playbook transition**: A terminal action which indicates that the routine playbook has decided to exit and transition to a target routine playbook
- **Flow invocation**: When the task playbook should invoke a flow
- **Flow transition**: A terminal action which indicates that the routine playbook has decided to exit and transition to a target flow

### Playbook Parameters

Playbooks can accept and emit context information using explicitly defined parameters. Parameters are used to store information about a conversation like user selections, results of actions, and so on. You can pass the values of these parameters between playbooks and [flows](https://cloud.google.com/dialogflow/cx/docs/concept/flow).

#### Parameter Declaration

You can define input (read) parameters and output (write) parameters.

Parameters have a name, description, and one of the following types:
- **String**
- **Number**
- **Boolean**
- **Tool-specific parameter type**

You can also specify whether a parameter is a list.

#### Input (Read) Parameters

For each playbook, you can define _input parameters_, also called _read parameters_, that allow playbooks to use values passed from flows and other playbooks.

Input parameters are defined per-playbook, and playbooks don't have visibility of [other Dialogflow CX console parameter types](https://cloud.google.com/dialogflow/cx/docs/concept/parameter) by default. When a flow transitions to a playbook, page and session parameters are propagated to the playbook if the target playbook has an input parameter with the same name.

#### Output (Write, Return) Parameters

For each playbook, you can define _output parameters_, also called _write parameters_ and _return parameters_, that allow playbooks to emit information to be used by other flows or playbooks.

#### Passing Parameters

Playbooks, unlike flows, **do not** support injecting parameter values with a particular syntax. Instead, playbooks rely on instructions and [few-shot prompt examples](https://cloud.google.com/vertex-ai/docs/generative-ai/learn/introduction-prompt-design#include-examples) to determine how parameter values should be used and how values should be decided when specifying parameter values.

**Parameter passing scenarios:**
- **Routine playbook to flow**: Define write parameters for the routine playbook. These parameters will become session parameters
- **Flow to routine playbook**: Flows write the session parameters. Define read parameters for the routine playbook of the same names
- **Task playbook to flow**: In the flow settings, define _input parameters_ of the same names
- **Flow to task playbook**: In the flow settings, define _return parameters_
- **Routine playbook to task playbook**: Define input parameters for the task playbook of the same names

### Playbook Tools

Using tools, you can connect playbooks to external systems. These systems can augment the knowledge of playbooks and empower them to execute complex tasks efficiently.

You can use [built-in tools](#built-in) or build customized tools to suit your requirements.

#### Tool Testing

Once you have created a tool, you can use the tool testing feature to verify that it works. When viewing a tool, click the **Test** button above the tool pane. This opens the tool for input in the simulator. Provide tool input, then click **View Output** to verify the correct tool output.

#### Built-in Tools

Built-in tools are hosted by Google. You can activate these tools in agents without the need for manual configuration.

**Supported built-in tools:**
- `Code Interpreter`: A Google first-party tool that combines the capability of code generation and code execution and allows the user to perform various tasks, including: data analysis, data visualization, text processing, solving equations or optimization problems

#### OpenAPI Tools

An agent can connect to an external API using an OpenAPI tool by providing the [OpenAPI](https://www.openapis.org/) schema. By default, the agent will call the API on your behalf.

**OpenAPI tool limitations:**
- Supported parameter types are `path`, `query`, `header`. The `cookie` parameter type is not supported yet
- Parameters defined by OpenAPI schema support the following data types: `string`, `number`, `integer`, `boolean`, `array`. The `object` type is not supported yet
- You currently can't specify query parameters in the console example editor
- Request and response body must be empty or JSON

**Authentication options:**
- Dialogflow Service Agent auth
- Service Account auth
- API key
- OAuth
- Bearer Token
- Mutual TLS authentication
- Custom CA certificate
- Secret Manager Authentication

#### Data Store Tools

For information about using data store tools with a playbook, see the [data store tools](https://cloud.google.com/dialogflow/cx/docs/concept/data-store/handler) documentation.

#### Connector Tools

Connector tools can be used by an agent to perform actions using your Connections configured in [Integration Connectors](https://cloud.google.com/integration-connectors/docs/overview).

**Supported Connector types include:**
- AlloyDB, Asana, Azure AD (Entra ID), BigQuery, Box, Cloud Search, Cloud Spanner, Cloud SQL (MySQL, PostgreSQL, SQL Server), Cloud Storage, Cloud Translation, Confluence, Couchbase, DocuSign, Dropbox, Dynamics 365, Elasticsearch, Email, Enterprise License Manager, Firestore, FreshBooks, FTP, GitHub, Gmail, Google Analytics, Google Calendar, Google Classroom, Google Cloud Natural Language, Google Contacts, Google Docs, Google Forms, Google Sheets, Google Slides, Greenplum, Instagram, Jira Cloud, Jira Service Management, Kintone, Magento, Mailchimp, MariaDB, Meta Ads, Microsoft Teams, Monday, MongoDB, Neo4j, OneDrive, Oracle DB, PayPal, PostgreSQL, Salesforce, Salesforce Marketing Cloud, SAP HANA, SAP SuccessFactors, ServiceNow, SharePoint, Shopify, Slack, Stripe, Trello, WordPress, Workday, Zendesk

#### Function Tools

If you have functionality accessible by your client code, but not accessible by OpenAPI tools, you can use function tools. Function tools are always executed on the client side, not by the agent.

**Process:**
1. Your client code sends a detect intent request
2. The agent detects that a function tool is required, and the detect intent response contains the name of the tool along with input arguments
3. Your client code calls the tool
4. Your client code sends another detect intent request that provides the tool result as output arguments

### Playbook Settings

In addition to [agent-level settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings), you can apply playbook-specific settings:

- **Enable data store RAG acceleration**: Reduces latency by calling data stores directly upon receiving a user utterance at each turn, bypassing metadata personalization and data store filters
- **Advanced speech settings**: For details about advanced speech options, see the [Advanced speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/advanced-speech) guide
- **Manual speech adaptation**: See [manual speech adaptation](https://cloud.google.com/dialogflow/cx/docs/concept/speech-adaptation#manual-adaptation)
- **DTMF settings**: See [DTMF for telephony integrations](https://cloud.google.com/dialogflow/cx/docs/concept/dtmf) for more information

### Playbook Best Practices

The following best practices can help you build robust agents:

#### Playbook Name in Natural Language

Playbook names should be clear, descriptive, and in natural English. This helps AI Generator's performance at runtime. For example, "Customer Help Center Playbook" is better than "company_specialist".

Keep all names under 64 characters, including English alphabets and spaces.

#### Concise Goals

Goals should be a concise description of the playbook's purpose.

#### Provide Quality Instructions

Instructions should:
- reflect the step-by-step approach to solving an end-user problem
- be concise natural language sentences of high level instructions
- be straightforward and specify the scenarios for tool uses

#### At Least One Example for Each Playbook

You should have at least one [example](https://cloud.google.com/dialogflow/vertex/docs/concept/examples) for each playbook, but it is recommended to have at least four. Examples should include happy path scenarios.

Without enough examples, a playbook is likely to result in unpredictable behavior. If your playbook is not responding or behaving in the manner you expect, missing or poorly defined examples are likely the cause.

#### Precision of Instructions and Examples

While it helps to write clear and descriptive instructions, it's really the quality and quantity of your examples that determine the accuracy of the playbook's behavior. In other words, spend more time writing thorough examples than writing perfectly precise instructions.

#### Tool Schema Validation

You should validate your tool schema. You can use the [Swagger Editor](https://editor.swagger.io/) to check your openAPI 3.0 schema syntax.

When your playbook relies on a tool to inform its response, an empty tool result can lead to unpredictable playbook behavior. Sometimes, the playbook AI Generator will hallucinate information in a response in lieu of a tool result.

**Examples of instructions to mitigate hallucinations:**
- "You must use the tool to answer all user questions"
- "If you don't get any data back from the tool, respond that you don't know the answer to the user's query"
- "Don't make up an answer if you don't get any data back from the tool"

#### Focused Playbooks

Avoid creating very large and complex playbooks. Each playbook should accomplish a specific and clear task. If you have a complex playbook, consider breaking it down into smaller sub-playbooks.

#### Avoid Loops and Recursion

Don't create loops or recursion when linking agents in your instructions. A loop can occur if you try routing to an ancestor playbook that, directly or indirectly, called the current one.

#### Planning for Performance

Generative features typically require several seconds or even tens of seconds to generate a response. Here are some strategies for optimizing performance:

- **Balance Generative Feature Usage**: Carefully consider the trade-off between the time required to execute multiple generative features and the value they bring to the conversation
- **Minimize Generative features Input**: Aim to gather and process the minimum amount of information required for an AI Generator to generate a useful response
- **Use Context Caching**: If you're using Gemini through a tool and have a large initial context, explore caching information using [Vertex AI Context Caching](https://cloud.google.com/vertex-ai/generative-ai/docs/context-cache/context-cache-overview)
- **Implement fixed responses for speed**: If your application doesn't require unique, dynamic content, consider storing frequently used responses in a traditional database like Firebase
- **Instruct the AI Generator to produce Concise Playbook Responses**: Short responses can significantly improve performance

---

## Data Store Concepts

### Data Stores

_Data stores_ are used by [data store tools](https://cloud.google.com/dialogflow/cx/docs/concept/data-store/handler) to find answers for end-user's questions from your data. Data stores are a collection of websites, documents, or data in third-party systems, each of which reference your data.

When an end-user asks the agent a question, the agent searches for an answer from the given source content and summarizes the findings into a coherent agent response. It also provides supporting links to the sources of the response for the end-user to learn more. The agent can provide up to five answer snippets for a given question.

#### Data Store Sources

There are different sources that you can supply for your data:

**Standard Sources:**
- **Website URLs**: Automatically crawl website content from a list of domains or web pages
- **BigQuery**: Import data from your BigQuery table
- **Cloud Storage**: Import data from your Cloud Storage bucket
- **AlloyDB**: Import data from your [AlloyDB](https://cloud.google.com/alloydb/docs) cluster
- **Bigtable**: Import data from a [Bigtable](https://cloud.google.com/bigtable/docs) table
- **Firestore**: Import data from your [Firestore](https://firebase.google.com/docs/firestore) collection
- **Cloud SQL**: Import data from a [Cloud SQL](https://cloud.google.com/sql/docs) table
- **Spanner**: Import data from a [Spanner](https://cloud.google.com/spanner/docs) table

**Restricted Access Sources:**
Google offers many additional first- and third-party data store sources as a restricted access feature. These include:

**Google Data Store Sources:**
- Google Drive, Gmail, Google Sites, Google Calendar, Google Groups

**Third-party Data Store Sources:**
- AODocs, Box, Confluence Cloud, Confluence Data Center, Dropbox, EntraID, HubSpot, Jira Cloud, Jira Data Center, Marketo, Notion, OneDrive, Microsoft Outlook, Salesforce, ServiceNow, SharePoint, Shopify, Slack, Microsoft Teams, WordPress

#### Website Content

When adding website content as a source, you can add and exclude multiple sites. When you specify a site, you can use individual pages or `*` as a wildcard for a pattern. All HTML and PDF content will be processed.

**Requirements:**
- You must [verify your domain](https://cloud.google.com/generative-ai-app-builder/docs/domain-verification) when using website content as a source

**Limitations:**
- Files from public URLs must have been crawled by the Google Search indexer, so that they exist in the search index
- A maximum of 200,000 pages are indexed. If the data store contains more pages, indexing will fail at that point

#### Import Data

You can import your data from either BigQuery or Cloud Storage. This data can be in FAQ form or unstructured, and it can be with metadata or without metadata.

**Data Import Options:**
- **Add/Update Data**: The provided documents are added to the data store. If a new document has the same ID as an old document, the new document replaces the old document
- **Override Existing Data**: All old data is deleted, then new data is uploaded. This is irreversible

**FAQ Data Store:**
FAQ data stores can hold answers to frequently asked questions (FAQ). When user questions are matched with high confidence to an uploaded question, the agent returns the answer to that question without any modification.

Data must be uploaded to the data store in `CSV` format. Each file must have a header row describing the columns.

**Example CSV format:**
```csv
"question","answer","title","url"
"Why is the sky blue?","The sky is blue because of Rayleigh scattering.","Rayleigh scattering","https://en.wikipedia.org/wiki/Rayleigh_scattering"
"What is the meaning of life?","42","",""
```

**Unstructured Data Store:**
Unstructured data stores can contain content in the following formats:
- `HTML`, `PDF`, `TXT`, `CSV`

**Limitations:**
- The maximum file size is 2.5MB for text-based formats, 100MB for other formats

**Data Store with Metadata:**
A title and `URL` can be provided as metadata. When the agent is in a conversation with a user, the agent can provide this information to the user.

To import content with metadata, you must provide one or more [JSON Lines](https://jsonlines.org/) files. Each line of this file describes one document.

**Field descriptions:**
- `id`: Unique identifier for the document
- `content.mimeType`: MIME type of the document. "application/pdf" and "text/html" are supported
- `content.uri`: URI for the document in Cloud Storage
- `structData`: Single line JSON object with optional `title` and `url` fields

#### Parse and Chunk Configuration

Depending on the data source, you might be able to configure [parse and chunk settings](https://cloud.google.com/generative-ai-app-builder/docs/parse-chunk-documents) as defined by Vertex AI Search.

#### Use Cloud Storage for a Data Store Document

If your content is not public, storing your content in [Cloud Storage](https://cloud.google.com/storage/docs) is the recommended option.

**Requirements:**
- Be sure that you have selected the project you use for the agent
- Use the [Standard Storage class](https://cloud.google.com/storage/docs/storage-classes#standard)
- Set the [bucket location](https://cloud.google.com/storage/docs/locations) to the same location as your agent

#### Languages

For supported languages, see the data store column in the [language reference](https://cloud.google.com/dialogflow/cx/docs/reference/language).

For best performance, it is recommended that data stores be created in a single language.

After creating a data store, you can optionally specify the data store language. If you set the data store language, you can connect the data store to an agent that is configured for a different language.

#### Supported Regions

For supported regions, see the [region reference](https://cloud.google.com/dialogflow/cx/docs/concept/region#avail).

#### Data Store Tracing

This feature includes two parts:

1. **Display of the data store internal execution tracings and step latencies in the agent simulator**
2. **Export of tracings and latency data into Cloud Logging and BigQuery**

**View data in the simulator:**
- Expand the details about a conversation turn by clicking on the expansion caret to the right of the agent's response
- The **execution** tab displays the internal data store execution traces
- The **latency** tab displays a time graph for various data store execution steps

**View tracing data in other locations:**
- **Conversation History**: If the conversational agent is configured with conversation history logging
- **Cloud Logging**: If the conversational agent is configured with Cloud Logging
- **BigQuery export**: If the conversational agent is configured with BigQuery export

### Data Store Tools

Data store tools can provide AI-generated agent responses based on website content and uploaded data. Your agent can find answers to end-users' questions from your [data stores](https://cloud.google.com/dialogflow/vertex/docs/concept/data-store) during [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment).

#### Create a Data Store Tool

1. Open the [Conversational Agents console](https://conversational-agents.cloud.google.com/) and choose a Google Cloud project
2. Select an agent from the drop-down menu
3. Navigate to the menu bar on the far left side of the page and select **Tools**
4. To create a new data store tool, click **+ Create**. Enter a unique **Name** for the tool and select **Data store** from the drop-down menu under **Type**
5. Under **Data stores**, click **Add data stores** to add one or more pre-existing data stores to the tool or **Create data store** to add a new one
6. After you've finished configuring the new data store, click **Create**
7. Click **Save** at the top of the **Create Tool** configuration to create the new data store tool

#### Add the Data Store Tool to a Fulfillment

1. In the far-left menu bar, select **Flows**
2. Select a flow and page, then click the page's **Route** that you'd like to use with your data store
3. In the **Route** menu, scroll to **Fulfillment > Data store tool**. Select your data store tool from the drop-down menu
4. In the **Route** menu, scroll to **Fulfillment > Agent responses**. Click **+Add dialogue response**, then **Data store tool response**
5. Configure how many source links and citations can appear in the response, as well as specify the fallback behavior if the data store response is empty
6. At the top of the **Route** menu, click **Save**

#### Data Store Types

There are three data store types:
- `PUBLIC_WEB`: A data store that contains public web content
- `UNSTRUCTURED`: A data store that contains unstructured private data
- `STRUCTURED`: A data store that contains structured data (for example FAQ)

#### Data Store Handlers

Data store handlers are a special type of [state handler](https://cloud.google.com/dialogflow/cx/docs/concept/handler) that can provide LLM generated agent responses based on your website content and uploaded data.

**Limitations:**
- This feature supports select languages in GA
- Only the following [regions](https://cloud.google.com/dialogflow/cx/docs/concept/region#avail) are supported: `global`, `us` multi-region, and `eu` multi-region
- Apps with both [chunked and non-chunked data stores](https://cloud.google.com/dialogflow/cx/docs/concept/data-store#parse-chunk) are not supported

**Access Control:**
If you are the project owner, you have all the permissions needed to create a data store handler. If you are not the project owner, you must have the following roles:
- Dialogflow Admin
- Discovery Engine Admin

#### Add a Data Store to an Agent

1. Select a page, then click **Add state handler**
2. Click the **Data stores** checkbox, then **Apply**
3. Click the **+** symbol in the top right corner of the **Data stores** section of the page
4. In the data stores menu that appears, click **Add data stores**
5. A table listing any existing data stores appears. Click the box next to the name of any data stores you want to use and click **Save**
6. To create a new data store, click **Create new data store**. You are automatically redirected to AI Applications

#### Special Intents

In addition to handling questions about the content you provide, the agent can handle the following types of questions:
- **Agent identification**: Handles questions like "Who are you?" or "Are you human?"
- **Escalate to a human agent**: Handles questions like "I want to talk to a human" or "I want to talk to a real person"

#### Agent Responses

In the **Agent responses** section, you can provide custom responses that reference generative answers. Use `$request.knowledge.answers[0]` in the **Agent says** section to provide the generative answer.

**Advanced response customization:**
Additional information might be available in `$request.knowledge.*` that could be used to customize the response:
- The identified sources of the answer with the following fields: snippet, title, uri
- The grounding confidence for the answer
- In case of an FAQ data store, the question corresponding to the answer that was selected

### Data Store Tool Settings

The following [data store tool](https://cloud.google.com/dialogflow/cx/docs/concept/data-store/handler) configuration settings are available.

#### Tool Settings Options

**Default:**
- Optimized for all agent types

**Optimized for voice:**
- This default tool type has been configured specifically for voice agents

**Customize:**
- Choosing the `Customize` option lets you specify your own Grounding, Rewriter, and Summarization parameters instead of using the `Default` and `Optimized for voice` assigned defaults

#### Grounding

Conversational Agents (Dialogflow CX) calculates a confidence level for each response generated from the content of your connected data stores. This gauges the confidence that all information in the response is supported by information in the data stores.

**Confidence Levels:**
There are 5 confidence levels to choose from: `VERY_LOW`, `LOW`, `MEDIUM`, `HIGH`, and `VERY_HIGH`.

You can also apply a grounding heuristics filter. If enabled, responses containing content that is likely inaccurate based on common hallucinations are suppressed.

#### Select Summarization Model

You can select the generative model used by a data store agent for the summarization generative request.

**Available Models:**
- **Default** (GA): This is the recommended configuration and is subject to change over time
- **gemini-2.5-flash** (GA): [Gemini 2.5 flash](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-flash)
- **gemini-2.5-flash-lite** (GA): [Gemini 2.5 flash lite](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-flash-lite)
- **gemini-2.0-flash-001** (GA): [Gemini 2.0 flash](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-0-flash)
- **gemini-2.0-flash-lite-001** (GA): [Gemini 2.0 flash lite](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-0-flash-lite)
- **gemini-2.0-flash-lite-001-voice-mode** (GA): [Gemini 2.0 flash lite](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-0-flash-lite) optimized for voice

#### Summarization Custom Prompt

You can either use a default summarization prompt with your selected summarization model or provide your own. The prompt is a text template that may contain predefined placeholders.

**Available placeholders:**
- `$original-query`: The user's query text
- `$rewritten-query`: Dialogflow uses a rewriter module to rewrite the original user query into a more accurate format
- `$sources`: Dialogflow uses Enterprise Search to search for sources based on the user's query
- `$end-user-metadata`: Information about the user sending the query
- `$conversation`: The conversation history
- `${conversation USER:"<user prefix>" AGENT:"<agent prefix>" TURNS:<turn count>}`: A parameterized version of the `$conversation` placeholder

#### Select Rewriter Model

When a user query is processed, the agent sends the user query and a prompt to the LLM to refactor the user query, which performs a **rewriter**.

**Available Models:**
- **Default** (GA): This is the recommended configuration and is subject to change over time
- **Disabled Rewriter** (GA): No query rewrite will occur. Latency will improve, but quality will be degraded
- **gemini-2.5-flash** (GA): [Gemini 2.5 flash](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-flash)
- **gemini-2.5-flash-lite** (GA): [Gemini 2.5 flash lite](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-flash-lite)
- **gemini-2.0-flash-001** (GA): [Gemini 2.0 flash](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-0-flash)
- **gemini-2.0-flash-lite-001** (GA): [Gemini 2.0 flash lite](https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-0-flash-lite)

#### Rewriter Custom Prompt

You can use a default prompt or optionally provide your own. The prompt is a text template that may contain predefined placeholders.

**Available placeholders:**
- `$original-query`: The user's query text
- `$conversation`: The conversation history
- `${conversation USER:"<user prefix>" AGENT:"<agent prefix>" TURNS:<turn count>}`: A parameterized version of the `$conversation` placeholder
- `$end-user-metadata`: Information about the user sending the query

#### Payload Settings

Payload settings provide a way to add the data store snippets as rich content in the response payload, which is rendered in the [messenger](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger). You have the option of turning this feature on or off.

### Data Store Performance Improvements

This guide provides recommendations for monitoring and improving the performance of data store handlers.

#### Track Your Agent's Performance

You can monitor your agents [conversation history](https://cloud.google.com/dialogflow/cx/docs/concept/conversation-history) and you can use the [analytics tool](https://cloud.google.com/dialogflow/cx/docs/concept/analytics) for agent statistics.

#### Run Self-Service Evaluation

You can run [self-service evaluation](https://github.com/GoogleCloudPlatform/dfcx-scrapi/blob/main/examples/vertex_ai_conversation/README.md) which will assess the quality of your data store agent and recommend changes.

#### Improve Agent Responses

If you find some responses during testing that don't meet your expectations, try the following:

- You can overwrite an answer by adding an [FAQ entry](https://cloud.google.com/dialogflow/cx/docs/concept/data-store#structured) for a specific question
- If you are experiencing low quality answers with a structured FAQ, try using unstructured FAQ
- Using [search configurations](#search-configuration) helps to ensure that the correct answers are provided
- Use the [parse and chunk configurations](https://cloud.google.com/dialogflow/cx/docs/concept/data-store#parse-chunk) to optimize responses
- To ban certain phrases, see [agent settings: banned phrases](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-generative-banned)
- To customize Responsible AI (RAI) content filtering, see [agent settings: safety filters](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-generative-safety)

#### Handle Conversation Digressions

An end-user may ask clarifying questions during a conversation. For example, during credit card information collection, they may want to clarify what a CVV is. In this case, your agent should answer the question and return to collecting the necessary credit card information.

#### Handle Undesired Intent Matches

If your agent is matching intents when it should be using a data store handler, you can try the following to correct this:

- Delete or modify training phrases that are vague, so that all of your training phrases precisely handle the desired intention and do not conflict with your data store content
- Use [negative examples](https://cloud.google.com/dialogflow/cx/docs/concept/intent#negative) to avoid intent matching

#### Data Store Filtering

In some cases, you may only want certain data stores available for queries, depending on session parameter values. For example, you may have unique data stores for product categories.

**To accomplish data store filtering for product categories:**
1. Set session parameters to product categories
2. Create condition routes that check the values of the session parameters and transition to a specific page that has the desired data store handler
3. The data store handler should transition back to the calling page, so that the conversation can continue

#### Personalization

To make generative answers more relevant to end-users, you can provide Conversational Agents (Dialogflow CX) with information about users.

This information is provided as JSON. There is no expected schema, so you are free to define the object properties. This JSON is sent to the large language model as-is, so descriptive property names and values lead to the best results.

**Example:**
```json
{
  "subscription plan": "Business Premium Plus",
  "devices owned": [
    {"model": "Google Pixel 7"},
    {"model": "Google Pixel Tablet"}
  ]
}
```

**Personalizing with the API:**
You can provide this data to Conversational Agents (Dialogflow CX) when sending detect intent requests. This information must be provided in every detect intent request, because it is not persisted in the session.

Provide this information in the `queryParams.endUserMetadata` field in the `Sessions.detectIntent` method.

**Personalizing with Dialogflow CX Messenger:**
You can provide this data to the Dialogflow CX Messenger integration. See the [setContext](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger#setcontext) method.

#### Search Configuration

To have better control over the agent behavior and improve the quality of the answers, boost and filter [search configurations](https://cloud.google.com/generative-ai-app-builder/docs/configure-serving-controls) are exposed to let you boost, bury and filter documents.

**Boost controls** enable you to change search result ranking by applying a boost value (greater than zero for higher ranking, less than zero for lower ranking) to specific documents.

**Filter controls** let you to either keep or remove search results based on the specified filter criteria.

**Boost Control Example:**
```json
"searchConfig": {
  "boostSpecs": [
    {
      "dataStores": [ "DATASTORE_ID" ],
      "spec": [
        {
          "conditionBoostSpecs": {
            "condition": "CONDITION",
            "boost": "1.0"
          }
        }
      ]
    }
  ]
}
```

**Filter Control Example:**
```json
"searchConfig": {
  "filterSpecs": [
    {
      "dataStores": [ "DATASTORE_ID" ],
      "filter": "CONDITION"
    }
  ]
}
```

### Data Store Hybrid Agents

If you have an existing Conversational Agents (Dialogflow CX) agent, you can upgrade this agent to a _hybrid agent_, which combines the power of precise conversation controls (flows, parameters, intents, conditions, transitions, and so on) with data store handler generative features.

As part of this upgrade, you may wish to delete or temporarily disable intent routes (while testing data store handlers) for certain conversation scenarios from your agent, because the data store handlers can handle those scenarios more simply.

#### Recommended Scenarios

**The following scenarios are recommended for data store handlers:**
- Questions that can be answered by your organization's documents or website
- FAQs that do not require database lookups

**The following scenarios are not recommended for data store handlers:**
- Content that does not have answers to desired questions
- Questions that require database lookups or server requests
- Scenarios that require data redaction
- Scenarios that require deterministic agent responses

#### Input Evaluation Order

Conversational Agents (Dialogflow CX) evaluates end-user input in the following order for hybrid agents:

1. Parameter input while form filling
2. Intent matches for [routes in scope](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route)
3. Data store handler with FAQ data store content
4. Data store handler with unstructured data store content

---

## Flow Concepts

### Flow-Based Agent Basics

Complex dialogs often involve multiple conversation topics. For example, a pizza delivery agent may have _food order_, _customer information_, and _confirmation_ as distinct topics. Each topic requires multiple conversational turns for an agent to acquire the relevant information from the end-user.

_Flows_ are used to define these topics and the associated conversational paths. Every agent has one flow called the [Default Start Flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start). This single flow may be all you need for a simple agent. More complicated agents may require additional flows, and different development team members can be responsible for building and maintaining these flows.

### Flows

Complex dialogs often involve multiple conversation topics. For example, a pizza delivery agent may have _food order_, _customer information_, and _confirmation_ as distinct topics. Each topic requires multiple conversational turns for an agent to acquire the relevant information from the end-user.

_Flows_ are used to define these topics and the associated conversational paths. Every agent has one flow called the [Default Start Flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start). This single flow may be all you need for a simple agent. More complicated agents may require additional flows, and different development team members can be responsible for building and maintaining these flows.

#### Default Start Flow

When you create an agent, the **Default Start Flow** is created automatically. For a simple agent, you can use this flow as your only flow. For more complex agents, you can add more flows, and the default start flow can be used as a simple entry point to the conversation.

When using the API, you can reference the default start flow with the following flow ID:
`00000000-0000-0000-0000-000000000000`

#### Flow Start Page

Every flow has a special page named **Start** in the console. When a flow is selected in the console, the start page is shown as a node on the graph. When a flow initially becomes active, this page becomes the current, active page.

A start page does not have parameters or responses messages like normal pages. However, you can send a message by using one of the following approaches:
- [Intent propagation](https://cloud.google.com/dialogflow/cx/docs/concept/handler#intent-prop)
- Use a simple `true` [condition](https://cloud.google.com/dialogflow/cx/docs/reference/condition) in a [route](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route) that has a fulfillment response or a transition target to a normal page with entry fulfillment
- [Custom events](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-custom)

**Reference start page in API requests:**
To reference a flow's start page in runtime API requests, use `START_PAGE` as a page ID.

To make design-time changes to a start page through the API, use the `get` and `patch/update` API methods for the `Flow` type.

#### Create a Flow

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click the add button in the **Flows** section
5. Select **Create flow**
6. Enter a display name for your flow
7. Click the flow you just created

**API:**
See the `create` method for the `Flow` type.

#### Flow Data

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose the Google Cloud project for the agent
3. Find the agent in the list
4. Click the agent display name
5. Click the flow in the **Flows** section
6. The flow's pages are populated in the **Pages** section
7. Click the flow in the graph
8. A flow edit panel appears. Use this panel to browse and edit additional flow data
9. Click **Save** to save any changes

**API:**
For flows, see the `get` and `patch/update` for the `Flow` type.
For pages, see the `get` and `patch/update` methods for the `Page` type.

**Flow Data includes:**
- **Pages**: The list of pages that make up the flow
- **Routes**: All of these routes may be called when the [start page](#start-page) for the flow is active. Routes with an intent requirement may be followed when other pages of the flow are active
- **Event handlers**: These handlers may be called when the flow is active

#### Flow Settings

The following settings are available for flows:

- **Display name**: A human-readable name for the flow
- **Description**: A description for the flow
- **ML settings**: Flow ML settings are also accessed and described in [agent ML settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-ml)
- **Language auto detection**: Language auto detection lets you specify which end-user languages Conversational Agents (Dialogflow CX) should automatically recognize and respond in
- **Flow lock**: A locked flow cannot be edited, including the following changes to its child resources:
  - [Pages](https://cloud.google.com/dialogflow/cx/docs/concept/page) cannot be created, edited, deleted
  - [Versions](https://cloud.google.com/dialogflow/cx/docs/concept/version) cannot be created, edited, deleted
  - [Flow-level route groups](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route-group-flow) cannot be created, edited, deleted
  - [Agent-level route groups](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route-group-agent) referenced by a locked flow or any page under a locked flow cannot be deleted, but they can still be edited
- **Advanced speech settings**: These [advanced speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/advanced-speech) can optionally override the same [agent speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-speech)
- **Speech adaptation settings**: Flow level speech adaptation settings with more detailed instructions in [manual speech adaptation](https://cloud.google.com/dialogflow/cx/docs/concept/speech-adaptation#manual-adaptation)
- **Input parameters**: Parameters from the task playbook that are made available to the flow
- **Return parameters**: Parameters that the flow returns to a task playbook

#### Delete a Flow

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Hover your mouse over the flow in the **Flows** section
5. Click the settings button
6. Select **Delete**

**API:**
See the `delete` method for the `Flow` type.

#### Train a Flow

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click **Agent Settings**
5. Open the **ML** tab
6. To train a single flow, click **Train** in the corresponding row
7. To train multiple flows, select them with checkboxes, then click **Train selected flow NLU model**

**API:**
See the `train` method for the `Flow` type.

#### Export a Flow

You can export a flow in two ways:

- **Data export**: This exports your flow as raw data, so it can be imported to any agent. When you export a flow, the resources referenced by the flow (intents, entities, webhooks) are also exported
- **Diagram export** ([Preview](https://cloud.google.com/products/#product-launch-stages)): This exports your flow as a visual diagram. The export format is draw.io XML, so you can import the diagram in [Lucidchart](https://www.lucidchart.com/pages/draw.io-import), [diagrams.net](https://www.diagrams.net/doc/faq/import-diagram), or any other diagram tool that can import the draw.io format

**Export options:**
- **Include referenced flows**: Exports the target flow and all levels of referenced flows. Referenced flows include the flows that the target flow is referencing in addition to flows referenced by subsequent referenced flows, with no maximum depth

#### Import a Flow

When you import a flow from a source agent to a target agent, the global resources referenced by the flow (intents, entities, webhooks) are imported along with the flow-specific data. If the target agent has any global resources with the same display names found in the source agent, Conversational Agents (Dialogflow CX) provides a summary of these resources, along with three options to resolve the conflicts for these resources:

- **Replace existing resources**: Source agent resources will overwrite target agent resources
- **Import as new resources**: Source agent resources will be added with a distinctive suffix in the name
- **Keep original resources**: Target agent resources will be unchanged

### Pages

A Conversational Agents (Dialogflow CX) conversation (session) can be described and visualized as a [state machine](https://en.wikipedia.org/wiki/Finite-state_machine). The states of a session are represented by _pages_.

For each [flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow), you define many pages, where your combined pages can handle a complete conversation on the topics the flow is designed for. At any given moment, exactly one page is the _current page_, the current page is considered _active_, and the flow associated with that page is considered _active_. Every flow has a special [start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page). When a flow initially becomes active, the start page becomes the current page. For each conversational turn, the current page will either stay the same or transition to another page.

You configure each page to collect information from the end-user that is relevant for the conversational state represented by the page.

#### Lifecycle of a Page

Once a page becomes active, the agent follows several steps which may involve entry fulfillment, prefilling forms, state handler evaluation, form parameter prompting, sending response messages to the end-user, and either a page change or a repeat loop:

1. **Entry fulfillment**: If entry [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) exists for the page, it is called. Any static responses provided by fulfillment are added to the [response queue](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment#queue)

2. **Form parameter pre-filling**: If the page has form parameters, they may be pre-filled:
   - Any set [session parameter](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#session) with the same name as a [form parameter](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form) is copied to the form parameter
   - If a [route](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route) triggered a transition to this page, and the route contains a matched [intent](https://cloud.google.com/dialogflow/cx/docs/concept/intent), any intent parameter with the same name as a [form parameter](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form) is copied to the form parameter

3. **State handler evaluation**: If any state handlers are [in scope](https://cloud.google.com/dialogflow/cx/docs/concept/handler#scope), they are evaluated according to the [handler evaluation order rules](https://cloud.google.com/dialogflow/cx/docs/concept/handler#eval)

4. **Form parameter prompting**: If all of the following are true, a form parameter prompt is added to the response queue:
   - The page has a form
   - There are required form parameters left to fill
   - A [reprompt handler](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#reprompt) was not followed in step 3

5. **Response delivery**: The remaining response queue messages are sent to the end-user, and the agent waits for end-user input

6. **Parameter filling**: If end-user input provides a prompted form parameter, fill the parameter. Continue to step 3

#### Page Lifecycle Navigation

The [simulator](https://cloud.google.com/dialogflow/cx/docs/concept/console#simulator) execution steps viewer allows you to switch between the steps for a specific conversation turn and brings the related agent builder elements into focus for each step.

#### Create a Page

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click the flow in the **Flows** section
5. Click the add button in the **Pages** section
6. Enter a display name for your page
7. Click **Save**

**API:**
See the `create` method for the `Page` type.

#### Page Data

The following data is associated with pages:

- **Display name**: A human-readable name for your page
- **Entry fulfillment** (also known as **Entry dialogue**): This is the [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) to call when the page initially becomes active
- **Parameters**: These are the parameter values in a page [form](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form) that capture structured input from the end-user
- **Routes**: These state handlers may be called when the page is active
- **Route groups**: The routes within these groups may be called when the page is active
- **Event handlers**: These event handlers may be called when the page is active

#### Page Settings

The following settings are available for pages:

- **Advanced speech settings**: These [advanced speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/advanced-speech) can optionally override the same [flow speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/flow#settings) and [agent speech settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-speech)
- **Speech adaptation settings**: Page level speech adaptation settings can optionally override the same [flow speech adaptation settings](https://cloud.google.com/dialogflow/cx/docs/concept/flow#settings)

#### Delete a Page

**Console:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click the flow in the **Flows** section
5. Click the page in the **Pages** section
6. Click the delete button

**API:**
See the `delete` method for the `Page` type.

### State Handlers

_State handlers_, also simply called _handlers_, are used to control the conversation by creating responses for end-users and/or by transitioning the current page. For each conversational turn, handlers are evaluated and may affect the session. Handlers have three general types of data:

#### Handler Components

**Handler Requirements:**
These are the requirements that must be satisfied for the handler to have any effect on the session. A handler is said to be _called_ when it satisfies its requirements and affects the session in some way.

**Handler Fulfillment:**
If a handler is called, an optional [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) is used to create responses for end-users. These responses are either defined in static agent data or retrieved dynamically from your [webhook service](https://cloud.google.com/dialogflow/cx/docs/concept/webhook).

**Handler Transition Target:**
If a handler is called, an optional transition target is used to change the current page. The next page can only be a [flow start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page) or a page within the currently active flow.

#### Handler Types

There are two types of state handlers with differing handler requirements:

**Routes:**
[Routes](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route) are called when an end-user input matches an [intent](https://cloud.google.com/dialogflow/cx/docs/concept/intent) and/or some [condition](https://cloud.google.com/dialogflow/cx/docs/reference/condition) on the session status is met. A route with an intent requirement is also called an _intent route_. A route with only a condition requirement is also called a _condition route_.

**Event Handlers:**
[Event handlers](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event) are called when an _event_ is invoked. Some [built-in events](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-built-in) are triggered when unexpected end-user input is received, or when a webhook error occurs. You can also define [custom events](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-custom) that you invoke when something happens outside the conversation.

#### Handler Processing Steps

There are three steps to processing a state handler:

1. **Scope**: A handler must be in [scope](https://cloud.google.com/dialogflow/cx/docs/concept/handler#scope) to have any effect on the session
2. **Evaluation**: Each handler in scope is [evaluated in order](https://cloud.google.com/dialogflow/cx/docs/concept/handler#eval). If a handler's requirements are met, it passes evaluation
3. **Call**: If a handler is in scope and passes evaluation, it is called. Any associated fulfillment is called, and any associated transition target is applied to the session

#### Scope

In order for a handler to be evaluated, it must be in _scope_. Handler scope is an important and powerful tool that helps you control the conversation. By controlling the scope of a handler, you can control:

- When an intent can be matched
- When a condition should be checked
- When a certain event can be handled
- When a page transition can occur
- When a static fulfillment response is provided
- When a webhook-enabled fulfillment is called for dynamic responses

**Detailed scoping rules:**
- Routes applied to the active flow:
  - If the current page is the [flow start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page), they are in scope
  - If the current page is not the flow start page, they are only in scope if they have an intent requirement
- Routes applied to the current page are in scope
- Event handlers applied to the active flow are in scope
- Event handlers applied to the current page are in scope
- Event handlers applied to a form parameter that the agent is currently attempting to fill are in scope

#### Routes

Routes have two requirements, and one or both must be provided. If both requirements are provided, they both must be satisfied in order to call the route:

**Intent Requirement:**
An [intent](https://cloud.google.com/dialogflow/cx/docs/concept/intent) which must be matched to end-user input for the current conversational turn. When a route has an intent requirement, it is called an _intent route_.

**Condition Requirement:**
A [condition](https://cloud.google.com/dialogflow/cx/docs/reference/condition) which must be met. When a route has a condition requirement, it is called a _condition route_.

**Route Groups:**
When building an agent, you may find that many pages have a common set of routes. To make routes reusable, you can define _route groups_. You can create these group resources reusable either within the flow or the entire agent.

- **Flow-level route groups**: Route group resources that are created with a flow as parent. They are reusable within the flow
- **Agent-level route groups**: Route group resources that are created with an agent as parent. They are reusable within the entire agent, but disallow routes that transition to a non [symbolic](#symbolic) page as target

**Flow-level Routes:**
_Flow-level routes_ are routes that are applied to a flow by adding them to the flow start page.

**Page-level Routes:**
_Page-level routes_ are routes that are applied to a page.

#### Event Handlers

Event handlers have one requirement in order to be called:

**Event Requirement:**
An _event_ which must be invoked. Events are identified by their name. Some built-in events are invoked when unexpected end-user input is received, or when a webhook error occurs. You can also define custom events that you invoke when something happens outside of the conversation.

**Flow-level Event Handlers:**
_Flow-level event handlers_ are event handlers that are applied to a flow.

**Page-level Event Handlers:**
_Page-level event handlers_ are event handlers that are applied to a page.

**Parameter-level Event Handlers:**
_Parameter-level event handlers_ are event handlers that are applied to a form parameter. They are also known as [reprompt handlers](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form-reprompt).

#### Built-in Events

The following events are built-in and are invoked by Conversational Agents (Dialogflow CX):

| Event name | Flow-level | Page-level | Parameter-level | Invoked when |
|------------|------------|------------|-----------------|--------------|
| `sys.no-match-default` | âœ” | âœ” | âœ” | End-user input does not match any intents for handlers that are in scope |
| `sys.no-match-[1-6]` | âœ” | âœ” | âœ” | If you provide handlers for any of these numerically ordered events, they are invoked instead of `sys.no-match-default` and in order |
| `sys.no-input-default` | âœ” | âœ” | âœ” | End-user input was not received |
| `sys.no-input-[1-6]` | âœ” | âœ” | âœ” | If you provide handlers for any of these numerically ordered events, they are invoked instead of `sys.no-input-default` and in order |
| `sys.invalid-parameter` | âœ” | | | Invoked when a [webhook response](https://cloud.google.com/dialogflow/cx/docs/concept/webhook#webhook-response) invalidates the parameter |
| `sys.long-utterance` | âœ” | âœ” | âœ” | End-user input exceeds the maximum allowed length (256 characters) matched by **non-generative intents** or **parameters** |
| `webhook.error` | âœ” | âœ” | | The webhook call returned an error |
| `webhook.error.timeout` | âœ” | âœ” | | The webhook call timed out |
| `webhook.error.bad-request` | âœ” | âœ” | | The webhook returned [400 Bad Request](https://cloud.google.com/dialogflow/cx/docs/concept/webhook#errors) |
| `webhook.error.rejected` | âœ” | âœ” | | The webhook returned [401 Unauthorized](https://cloud.google.com/dialogflow/cx/docs/concept/webhook#errors) or [403 Forbidden](https://cloud.google.com/dialogflow/cx/docs/concept/webhook#errors) |
| `webhook.error.unavailable` | âœ” | âœ” | | The webhook returned [503 Service Unavailable](https://cloud.google.com/dialogflow/cx/docs/concept/webhook#errors) |
| `webhook.error.not-found` | âœ” | âœ” | | The webhook call failed because the webhook URL was unreachable |
| `flow-cancelled` | âœ” | âœ” | | End-user requested cancellation of flow |
| `flow-failed` | âœ” | âœ” | | This flow wasn't able to complete the given task |
| `flow-failed-human-escalation` | âœ” | âœ” | | End-user requested to talk to human agents |

#### Custom Events

You can create custom events and event handlers. Custom events are used to handle things that happen outside the conversation with the end-user. For example, the end-user clicked a button, a certain amount of time has passed, available inventory has changed during the conversation, and so on.

Events are simply identified by name. You should avoid using event names that start with `sys.` or `webhook.` to avoid conflict with built-in events.

#### Evaluation Order

Handlers are evaluated in a specific order. The following general rules apply:

1. Only handlers in [scope](#scope) are evaluated
2. Only handlers whose requirements are satisfied can be called
3. If a handler without a transition target is called, evaluation of the list of handlers continues
4. If a handler with a transition target is called, evaluation of the list of handlers ends
5. If a handler with fulfillment is called, and the fulfillment results in a webhook error:
   - If the handler has a transition target defined, the webhook silently fails
   - If an event handler is in scope for the event, it handles the event and evaluation of the list of handlers ends
   - If no event handler is in scope for the event, the webhook silently fails
6. When an intent requirement is satisfied, the intent is consumed, so only the first route handler found for the intent can be called
7. When a condition requirement is satisfied, the condition is not consumed, so multiple routes with the condition can be called
8. When an event requirement is satisfied, the event is consumed, so only the first event handler found for the event can be called

**Three phases to the evaluation:**

1. **Routes that have an intent requirement** are evaluated in this order:
   - Page-level: Individual routes applied to the current page, in the order supplied
   - Page-level groups: [Route groups](#route-group) applied to the current page, in the order supplied
   - Flow-level: Routes applied to the active flow, in the order supplied
   - Flow-level groups: [Route groups](#route-group) applied to the active flow, in the order supplied

2. **Routes with only a condition requirement** are evaluated in this order:
   - Page-level: Individual routes applied to the current page, in the order supplied
   - Page-level groups: [Route groups](#route-group) applied to the current page, in the order supplied
   - Flow-level (Only if the current page is the [flow start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page)): Routes applied to the active flow, in the order supplied
   - Flow-level groups (Only if the current page is the [flow start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page)): [Route groups](#route-group) applied to the active flow, in the order supplied

3. **Event handlers** are evaluated in this order:
   - Parameter-level: Event handlers applied to the current page's form parameter that the agent is currently attempting to fill (reprompt handlers), in the order supplied
   - Page-level: Event handlers applied to the current page, in the order supplied
   - Flow-level: Event handlers applied to the active flow, in the order supplied

#### Symbolic Transition Targets

When entering a transition target for a handler, you can enter specific flows or pages, but you can also enter symbolic transition targets:

| Symbolic transition target | Description |
|---------------------------|-------------|
| `START_PAGE` | Transition to the like-named active flow's [start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page) |
| `END_FLOW` | End the currently active flow and transition back to the page that caused a transition to the current flow |
| `END_FLOW_WITH_CANCELLATION` | End the currently active flow and transition back to the page that caused a transition to the current flow. The calling page can handle this transition with the `flow-cancelled` [built-in event](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-built-in) |
| `END_FLOW_WITH_FAILURE` | End the currently active flow and transition back to the page that caused a transition to the current flow. The calling page can handle this transition with the `flow-failed` [built-in event](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-built-in) |
| `END_FLOW_WITH_HUMAN_ESCALATION` | End the currently active flow and transition back to the page that caused a transition to the current flow. The calling page can handle this transition with the `flow-failed-human-escalation` [built-in event](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event-built-in) |
| `END_SESSION` | Clear current session and transition to the special page named `END_SESSION`. The next user input will restart the session at the [start page](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start-page) of the [Default Start Flow](https://cloud.google.com/dialogflow/cx/docs/concept/flow#start) |
| `PREVIOUS_PAGE` | Transition to the previous page that caused a transition to the current page. The page state from the previous page will be restored after transition |
| `CURRENT_PAGE` | Re-transition to the current page. This can be useful if you want the agent to repeat something |

#### Handler Call Stack and Flow Stack Limit

When a session transitions from flow to flow with specific transition targets, each flow is pushed onto the flow [stack](https://en.wikipedia.org/wiki/Stack_\(abstract_data_type\)).

**Handler Call Stack:**
When a session transitions to `END_FLOW`, it returns back to the calling page that caused a transition to the completed flow. In this situation, the handler call stack is preserved. All handlers that were previously evaluated from the calling page will be skipped, and the remaining handlers will be evaluated in order.

**Flow Stack Limit:**
Maximum flow stack limit is 25. Exceeding the maximum stack limit may cause flows to be popped from the stack, leading to unexpected behavior when using the `END_FLOW` transition. To avoid these potential issues, minimize the number of flow-to-flow transitions preceding the `END_FLOW` transition.

If the flow stack is empty, the `END_FLOW` transition ends the session.

#### Set Conditions

To set [conditions](https://cloud.google.com/dialogflow/cx/docs/reference/condition) with the console, you supply condition rules with one of three logical options:

- **Match AT LEAST ONE rule (OR)**
- **Match EVERY rule (AND)**
- **Customize expression**

As a convenience, you can use the AND/OR options to create simple or compound conditions for parameter values.

You can use the free form **Customize expression** option for all types of conditions, including [system functions](https://cloud.google.com/dialogflow/cx/docs/reference/condition#func) and [boolean constants](https://cloud.google.com/dialogflow/cx/docs/reference/condition#bool-const).

---

## Intents, Entities, Parameters, Fulfillments, Webhooks, and Generative Flow Features

### Intents

An _intent_ categorizes an end-user's intention for one conversation turn.

An intent contains the following data:

- **Display name**: Name displayed on the console for the intent
- **Labels**: Labels that help categorize intents (e.g., head intent)
- **Training phrases**: Example phrases for what end-users might type or say, known as _end-user input_
- **Parameters**: You define your training phrases to use [parameters](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#intent) to extract values from specific parts of the end-user input
- **DTMF patterns**: See [DTMF for telephony integrations](https://cloud.google.com/dialogflow/cx/docs/concept/dtmf)

#### Intent Matching

When an end-user enters input (text, speech, or telephone key-presses), Conversational Agents (Dialogflow CX) compares the input to intent training phrases to find the best match. This process is called intent matching. Intent matching can only occur for intents associated with an [intent route](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route) (a state handler with an intent requirement) in [scope](https://cloud.google.com/dialogflow/cx/docs/concept/handler#scope).

Key-press input is matched according to [DTMF patterns](https://cloud.google.com/dialogflow/cx/docs/concept/dtmf). When searching for a matching intent to text, Conversational Agents (Dialogflow CX) scores potential matches with an _intent detection confidence_, also known as the _confidence score_. These values range from 0.0 (completely uncertain) to 1.0 (completely certain).

#### Training Phrases

_Training phrases_ are example phrases for what end-users might type or say, referred to as _end-user input_. For each intent, you create many training phrases. When an end-user input resembles one of these phrases, Conversational Agents (Dialogflow CX) matches the intent.

You don't have to define every possible example, because Conversational Agents (Dialogflow CX)'s built-in machine learning expands on your list with other, similar phrases. You should create at least 10-20 (depending on complexity of intent) training phrases, so your agent can recognize a variety of end-user inputs.

**Auto-generate and auto-translate training phrases:**
You have the option of using AI generation to auto-generate training phrases instead of entering them manually. To use this feature:

1. Navigate to the **Manage** tab and click **Intents**. Either choose an existing intent or click **+ Create** to create a new one
2. Make sure to enter a purpose for the intent in the **Description** field
3. Click the **__ newly AI-generated phrases** radial button. The default value is 3
4. Click **+ Add**. The AI will generate your specified number of training phrases and populate them into the table

**Annotate training phrases:**
You control how end-user data is extracted by _annotating_ parts of your training phrases and configuring the associated [parameters](https://cloud.google.com/dialogflow/cx/docs/concept/parameter).

For example, consider a training phrase like "What is the forecast tomorrow for Tokyo?" You should annotate "tomorrow" with a `date` parameter and "Tokyo" with a `location` parameter.

#### Default Intents

**Default welcome intent:**
When you create an agent, a default welcome intent is created for you. For [some languages](https://cloud.google.com/dialogflow/cx/docs/reference/language#table), the intent has simple training phrases like "Hi" or "Hello" that are meant to match initial end-user input.

When using the API, you can reference this intent with the following intent ID:
`00000000-0000-0000-0000-000000000000`

**Default negative intent:**
When you create an agent, a default negative intent is created for you. You can add training phrases to this intent that act as negative examples.

When using the API, you can reference this intent with the following intent ID:
`00000000-0000-0000-0000-000000000001`

**Cancel intents:**
During a conversation, the end-user may want to cancel the current conversation topic. You can create one or more _cancel intents_ for your agent to handle this situation.

#### Intent Management

**Create an intent:**
- **Console**: Navigate to Manage tab â†’ Intents â†’ +Create
- **API**: See the `create` method for the `Intent` type

**Delete an intent:**
- **Console**: Navigate to Manage tab â†’ Intents â†’ hover over intent â†’ click delete button
- **API**: See the `delete` method for the `Intent` type

**Access intent data:**
- **Console**: Navigate to Manage tab â†’ Intents â†’ click the intent
- **API**: See the `get` and `patch/update` methods for the `Intent` type

**Intent suggestions:**
Dialogflow automatically analyzes no-match occurrences during conversations and can suggest new intents or recommend additional training phrases for existing intents.

**Split intents:**
You can split one intent into two intents using the console by selecting training phrases from a source intent and moving them to a new intent.

**Compare and merge intents:**
You can compare or merge two intents to a single intent using the console.

**Export and import intents:**
You can export and import intents for sharing across agents. One of the export format options is CSV.

**Head and supplemental intents:**
- **Head intent**: Identifies the end-user's primary purpose for interacting with an agent
- **Supplemental intent**: Identifies an end-user's subsequent questions that are related to the head intent

### Entities

_Entity types_ are used to control how data from end-user input is extracted.

Conversational Agents (Dialogflow CX) provides predefined [system entities](https://cloud.google.com/dialogflow/cx/docs/concept/entity-system) that can match many common types of data. For example, there are system entities for matching dates, times, colors, email addresses, and so on. You can also create your own [custom entities](https://cloud.google.com/dialogflow/cx/docs/concept/entity-custom) for matching custom data.

#### Entity Terminology

- **Entity type**: Defines the type of information you want to extract from user input
- **Description**: Describes the purpose of the entity type
- **Entity entry**: For each entity type, there can be many _entity entries_. Each entity entry provides a set of words or phrases that are considered equivalent
- **Reference value**: The primary value for an entity entry
- **Synonyms**: Alternative words or phrases that are considered equivalent to the reference value

#### Entity Types

**System entities:**
Predefined by Conversational Agents (Dialogflow CX) for common data types like dates, times, colors, email addresses, etc.

**Custom entities:**
Defined by developers to represent domain-specific data. For example, you could define a vegetable entity that can match the types of vegetables available for purchase with a grocery store agent.

**User entities:**
Built for individual users, such as preferences or playlists.

#### Entity Management

**Create an entity type:**
- **Console**: Navigate to Manage tab â†’ Entity Types â†’ +Create
- **API**: See the `create` method for the `EntityType` type

**Delete an entity type:**
- **Console**: Navigate to Manage tab â†’ Entity Types â†’ hover over entity type â†’ click delete button
- **API**: See the `delete` method for the `EntityType` type

**Access entity type data:**
- **Console**: Navigate to Manage tab â†’ Entity Types â†’ click the entity type
- **API**: See the `get` and `patch/update` methods for the `EntityType` type

### Parameters

_Parameters_ are used to capture and reference values that have been supplied by the end-user during a session. Each parameter has a name and an [entity type](https://cloud.google.com/dialogflow/cx/docs/concept/entity). Unlike raw end-user input, parameters are structured data that can easily be used to perform some logic or generate responses.

#### Parameter Usage

There are four general ways in which parameters are used:

1. **Define at design-time**: During design-time, you use either the console or the API to define parameters
2. **Reference at design-time**: Parameter references are variables that hold parameter values to be extracted at runtime
3. **Set at runtime**: At runtime, the Conversational Agents (Dialogflow CX) service, your service that calls the API, and your webhook service can all set parameter values
4. **Get at runtime**: At runtime, your parameter references contain the parameter values that have been set

#### Parameter Naming

The following rules apply to parameter naming:

- Use the following characters: `[A-Z]`, `[a-z]`, `[0-9]`, `.`, `-`, `_`
- Parameter names are case insensitive
- When you create parameters with the same ID or display name in different intents or forms, make sure that the entity type and other settings are the same for all definitions

#### Parameter Value Types

Parameter values support multiple value types:

- **Scalar**: A single numeric or string value
- **Composite**: A JSON object populated by matching a [composite entity](https://cloud.google.com/dialogflow/cx/docs/concept/entity-options#comp), or by filling of an [intent parameter](#intent-ref), which contains `original` and `resolved` fields
- **List**: A list of scalar or composite values populated for a parameter configured as a list

#### Intent Parameters

[Intents](https://cloud.google.com/dialogflow/cx/docs/concept/intent) use parameters to extract data provided by end-users when intents are matched.

**Define intent parameters:**
Intent parameters are defined at design-time when creating [intent data](https://cloud.google.com/dialogflow/cx/docs/concept/intent) or when [annotating training phrases](https://cloud.google.com/dialogflow/cx/docs/concept/intent#annot).

**Reference intent parameters:**
Intent parameter references can be used in static fulfillment response messages of [intent routes](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route).

To reference a parameter for the current matched intent, use one of the following formats:
- `$intent.params.parameter-id.original`
- `$intent.params.parameter-id.resolved`

**Set intent parameters:**
When an end-user input matches an intent at runtime, any parameter used by an [annotation](https://cloud.google.com/dialogflow/cx/docs/concept/intent#annot) for the associated training phrase is set by Conversational Agents (Dialogflow CX).

**Get intent parameters:**
During the conversational turn in which an intent is matched, your code can access the intent parameter values.

#### Form Parameters

For each page, you can define a _form_, which is a list of parameters that should be collected from the end-user for the page. The agent interacts with the end-user for multiple conversation turns, until it has collected all of the required _form parameters_, which are also known as _page parameters_.

**Form parameter data:**
- **Display name**: A name that identifies the parameter
- **Entity type**: The [entity type](https://cloud.google.com/dialogflow/cx/docs/concept/entity) associated with the parameter
- **Required**: Indicates whether the parameter is required
- **Default Value**: The default value of an optional parameter
- **Is list**: If true, the parameter is treated as a list of values
- **Redact in log**: If true, end-user provided parameter data is [redacted](#redact)
- **Initial prompt fulfillment**: Initial prompts in the form of [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) to request a required parameter value from the end-user
- **Reprompt event handlers**: Used when the agent needs to reprompt the end-user to fill the parameter after a failed attempt

#### Session Parameters

When a parameter of any type is set at runtime, the parameter is written to the session and becomes a _session parameter_. These parameters are not explicitly defined at design-time. You can reference these session parameters at any point during a session.

**Reference session parameters:**
Session parameter references can be used in the static response messages for various types of [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment).

To reference a session parameter, use the following formats:

**Scalar:**
`$session.params.parameter-id`

**Composite:**
- To access a member: `$session.params.parameter-id.member-name`
- To access the original value: `$session.params.parameter-id.original`

**List:**
- To access a complete list: `$session.params.parameter-id`
- To access the ith element: `$session.params.parameter-id[i]`

#### Parameter Propagation

When an end-user input provides a parameter value, the parameter may be propagated to other levels:

- When an intent parameter is set by an intent match, like-named form parameters for the active page are set to the same value
- When an intent parameter is set by an intent match, or a form parameter is set while filling a form, the parameter becomes a session parameter

#### DTMF for Telephony Integrations

You can enable and configure DTMF (Dual-tone multi-frequency signaling) for a parameter. Once enabled, an end-user for an agent using a telephony [integration](https://cloud.google.com/dialogflow/cx/docs/concept/integration) can use the telephone keypad to provide parameter values.

#### Parameter Redaction

For any intent or form parameter, you can enable parameter redaction, which will redact end-user runtime parameter data from logs and Conversational Agents (Dialogflow CX) internal storage. Redacted parameters are shown as `$parameter-name_redacted` in logs.

### Fulfillments

For an agent's conversational turn, the agent must respond to the end-user with an answer to a question, a query for information, or session termination. Your agent may also need to contact your service to generate dynamic responses or take actions for a turn. _Fulfillment_ is used to accomplish all of this.

A fulfillment may contain any of the following:

- Static response messages
- Webhook calls for dynamic responses and/or to take actions
- Parameter presets to set or override parameter values

#### Fulfillment Use Cases

Fulfillment is used everywhere that a response message is needed:

- [Page entry fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/page)
- [Routes](https://cloud.google.com/dialogflow/cx/docs/concept/handler#route)
- [Event handlers](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event)
- [Initial prompts for forms](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form)
- [Reprompt handlers for forms](https://cloud.google.com/dialogflow/cx/docs/concept/parameter#form-reprompt)

#### Agent Responses (Dialogue Options)

**Static text response:**
Static text response messages send text dialogue to the end-user. If your detect intent API calls or integration calls use speech synthesis, this text will be used to generate audio content.

**Custom payload:**
Some [integrations](https://cloud.google.com/dialogflow/cx/docs/concept/integration) support a custom payload response to handle rich responses. These custom payloads must be supplied in the JSON format defined in the integration's documentation.

**Live agent handoff:**
This response signals to the detect intent API caller that the conversation should be handed off to a human agent.

**Conversation success metadata:**
This response signals to the detect intent API caller that the conversation with the Conversational Agents (Dialogflow CX) agent succeeded.

**Play prerecorded audio:**
This response plays an audio file for [integrations](https://cloud.google.com/dialogflow/cx/docs/concept/integration) that support this feature.

**Output audio text:**
This response is similar to the [text](#text) response, however it is only applicable to speech synthesis.

**Conditional response:**
This response type is used for conditional responses with the format:
```
if [condition]
  [response]
elif [condition]
  [response]
else
  [response]
endif
```

**Telephony transfer call:**
For some telephony integrations, you can specify a US phone number for call transfer.

**Data store tool response:**
This response type configures agent responses returned from linked [data store tools](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment#data_store_tools).

#### Channel-Specific Response Messages

When defining fulfillment, you can create _channel-specific response messages_, so you can create targeted responses for text chat, voice, SMS, specific integrations that support channels, and so on.

#### Custom Payload Templates

If you use [custom payloads](#payload) often, you should use _custom payload templates_. Custom payloads are sometimes large and complex, so using templates can help make the agent creation process easier.

#### Webhook Calls

When a fulfillment is called, and the fulfillment has a [webhook](https://cloud.google.com/dialogflow/cx/docs/concept/webhook), the agent sends a request to your webhook. Your webhook can take any actions necessary within your service, provide a dynamic response message, override parameter values, and change the current page.

#### Parameter Presets

You can use a fulfillment to provide presets that set or override current parameter values. These presets will be applied before resolving static response messages or calling a webhook.

#### Response Queue

During an agent's turn, it is possible (and sometimes desirable) to call multiple fulfillments, each of which may generate a response message. Conversational Agents (Dialogflow CX) maintains these responses in a _response queue_.

#### Partial Response for Streaming API

By default, Conversational Agents (Dialogflow CX) only sends the ordered responses to the end-user once the agent's turn is over. You can also enable the **Return partial response** option in fulfillment to return currently queued responses as a partial response when using the streaming APIs.

#### Speech Synthesis Markup Language (SSML)

You can use Speech Synthesis Markup Language (SSML) in text or output audio text fulfillment fields. This allows you to customize your audio response by providing details on pauses, and audio formatting for acronyms, dates, times, abbreviations, or text that should be censored.

### Webhooks

_Webhooks_ are services that host your business logic or call other services. During a session, webhooks allow you to use the data extracted by Conversational Agents (Dialogflow CX)'s natural language processing to generate dynamic responses, validate collected data, or trigger actions on the backend.

A webhook can either be a _standard webhook_ or a _flexible webhook_. With a standard webhook, the request and response fields are defined by Conversational Agents (Dialogflow CX). With a flexible webhook, you define the request and response fields.

#### Standard Webhooks

With standard webhooks, you use Conversational Agents (Dialogflow CX)-defined request and response messages. The request message provides many details about the session. For example, current active page, recent matched intent, session parameter values, and agent-defined responses are all included.

**Standard webhook request:**
When a [fulfillment](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment) with a webhook is called, Conversational Agents (Dialogflow CX) sends an HTTPS POST webhook request to your webhook service. The body of this request is a `WebhookRequest` JSON object with information about the session.

**Standard webhook response:**
Once your webhook service receives a webhook request, it needs to send a webhook response. The following limitations apply to your response:

- The response must occur within a timeout that you configure when [creating the webhook resource](#create), otherwise the request will time out
- The response must be less than or equal to 64 KiB in size

#### Flexible Webhooks

With flexible webhooks, you define the request HTTP method, request URL parameters, and fields of the request and response messages. The request can only provide selected parameter values, and the response can only provide parameter override values.

**Flexible webhook request:**
When creating the webhook resource for your agent, you can specify the following for webhook requests:

- The HTTP method used for webhook requests sent to your webhook service
- Session parameter values that Conversational Agents (Dialogflow CX) should send to your webhook service using the URL
- If you choose `POST`, `PUT`, or `PATCH` as the method, you can specify session parameter values that Conversational Agents (Dialogflow CX) should send to your webhook service through the request JSON body

**Flexible webhook response:**
When creating the webhook resource for your agent, you can specify session parameters that Conversational Agents (Dialogflow CX) should set to specific fields of the webhook response at runtime.

#### Webhook Service Requirements

The following requirements must be met by your webhook service:

- It must handle HTTPS requests. HTTP is not supported
- Its URL for requests must be publicly accessible, unless it is hosted as a [Cloud Run resource](#cloud-run) or it is accessed as a [Service directory](#sd) webhook
- It must handle requests and responses as described in the [standard webhook](#standard) or [flexible webhook](#flexible) section

#### Authentication

It's important to secure your webhook service, so that only you or your Conversational Agents (Dialogflow CX) agent are authorized to make requests. Conversational Agents (Dialogflow CX) supports the following mechanisms for authentication:

- **Authentication headers**: For webhook settings, you can specify optional HTTP header key-value pairs
- **Basic auth with username and password**: For webhook settings, you can specify optional login username and password values
- **Third-party OAuth**: You can specify the Third-party OAuth configuration so that Conversational Agents (Dialogflow CX) exchanges an access token from the OAuth system
- **Service agent access tokens**: Discontinued
- **Service account**: You can use a [service account](#service-account-auth) for authentication
- **Service agent ID tokens**: You can select ID token in Service agent auth to use [service agent ID tokens](#service-agent-auth-id-token) for authentication
- **Mutual TLS authentication**: See the [Mutual TLS authentication](https://cloud.google.com/dialogflow/cx/docs/concept/mtls) documentation

#### Webhook Errors

If your webhook service encounters an error while handling a webhook request, your webhook code should return one of the following HTTP status codes:

- `400` Bad Request
- `401` Unauthorized
- `403` Forbidden
- `404` Not found
- `500` Server fault
- `503` Service Unavailable

#### Using Cloud Run

Conversational Agents (Dialogflow CX) integrates with [Cloud Run](https://cloud.google.com/run/docs), so you can create a secure, serverless webhook.

#### Using Service Directory for Private Network Access

Conversational Agents (Dialogflow CX) integrates with [Service Directory private network access](https://cloud.google.com/service-directory/docs/private-network-access-overview), so it can connect to webhook targets inside your VPC network.

### Generative Flow Features

During a conversation, Conversational Agents (Dialogflow CX) agents always use language models for understanding end-user intention, but you can choose whether and how language models are used for agent responses. You can decide between fully generative, partly generative, and deterministic features when designing your agent.

#### Fully Generative

The fully generative features are built on [Vertex AI](https://cloud.google.com/vertex-ai/docs) large language models (LLMs) for both understanding end-user intention as well as generating agent responses. These features are easy to use and provide a very natural conversation.

**Playbooks:**
[Playbooks](https://cloud.google.com/dialogflow/cx/docs/concept/playbook) provide a new way for creating virtual agents using LLMs. You only need to provide natural language instructions and structured data. This can significantly reduce the virtual agent creation and maintenance time, and enable brand new types of conversational experiences for your business.

**Data stores:**
[Data stores](https://cloud.google.com/dialogflow/cx/docs/concept/data-store) parse and comprehend your public or private content (website, internal documents, and so on). Once this information is indexed, your agent can answer questions and have conversations about the content. You just need to provide the content.

#### Deterministic Flows

If you require more deterministic control over the conversation and all responses generated by the agent, you can design your agent with flows.

**Flows:**
[Flows](https://cloud.google.com/dialogflow/cx/docs/basics) use language models for understanding end-user intention during a conversation, which may not be completely deterministic. However, once intention is established, you have complete control over the conversation flow and agent responses. Designing an agent with deterministic flows typically takes more design time, but this is a good option for agents that require explicit control over agent responses.

#### Partly Generative Flows

Flows have some optional generative features that you can use when you don't need deterministic control over agent responses in certain conversation scenarios.

**Generators:**
[Generators](https://cloud.google.com/dialogflow/cx/docs/concept/generative/generators) are used to generate agent responses. Rather than providing the agent response explicitly, you provide a LLM prompt that can handle many scenarios including conversation summarization, question answering, customer information retrieval, and escalation to a human.

**Generative fallback:**
[Generative fallback](https://cloud.google.com/dialogflow/cx/docs/concept/generative/generative-fallback) is used to generate agent responses when end-user input does not match an expected intention. You can enable generative fallback in certain scenarios by providing a LLM prompt to generate the response.

---

## Advanced Concepts

### Agent Settings

Agents have many settings that affect behavior. Each console provides different settings.

#### Conversational Agents Console Agent Settings

**General settings:**
- **Display name**: A human-readable name for your agent
- **Time zone**: The default time zone for your agent
- **Conversation start**: Determines whether your agent starts the conversation with a generative playbook or a deterministic flow
- **Agent location**: The agent region you selected when creating the agent
- **Agent lock**: Indicates whether the agent is locked. A locked agent cannot be edited
- **Logging settings**: Enable Cloud Logging, conversation history, and consent-based end-user input redaction
- **BigQuery export**: Enable BigQuery export with dataset and table names
- **Intent Suggestions**: Enable intent suggestions
- **User feedback**: Enable feedback about the quality of the agent's answers
- **Git integration**: Add a Git integration

**Generative AI settings:**
- **Generative model selection**: Select the model used by generative features
- **Token limits**: Input and output token limits for the generative model
- **Temperature**: Control how creative the responses are
- **Context token limits**: Cull past turns from the LLM prompt to keep prompt size manageable
- **Banned phrases**: List of phrases that are banned for generative AI
- **Safety filters**: Configure sensitivity levels for different Responsible AI categories
- **Prompt security**: Enable prompt security checks to prevent prompt injection attacks
- **Generative Fallback**: Text prompt configuration

**Deterministic Flows:**
- **Spell correction**: Enable spelling and grammar correction for end-user input
- **Flow-specific ML settings**: NLU type, auto train, classification threshold, training status
- **Language**: Languages supported by your agent

**Connectivity:**
- **Custom payload template**: Create descriptions and payloads for custom payload templates
- **Parameter definition**: Define parameters sent to webhooks
- **Client certificate settings**: Upload SSL certificates

**Speech and IVR:**
- **Text-to-Speech**: Voice selection, voice pitch, speaking speed, pronunciation
- **Speech-to-Text**: Auto speech adaptation, advanced speech settings, DTMF settings, manual speech adaptation
- **Call companion**: Configure call companion settings

#### Dialogflow CX Console Agent Settings

**General settings:**
- **Display name**: A human-readable name for your agent
- **Time zone**: The default time zone for your agent
- **Default language**: The default language supported by your agent
- **Agent lock**: Indicates whether the agent is locked
- **Logging settings**: Enable Cloud Logging, interaction logging, and consent-based end-user input redaction
- **BigQuery export**: Enable BigQuery export with dataset and table names
- **Intent Suggestions**: Enable intent suggestions
- **Custom payload template**: Create descriptions and payloads for custom payload templates

**ML settings:**
- **Allow ML to correct spelling**: Enable spelling and grammar correction
- **Flow-specific ML settings**: NLU type, auto train, classification threshold, training status

**Generative AI settings:**
- **Banned phrases**: List of phrases that are banned for generative AI
- **Safety filters**: Configure sensitivity levels for different Responsible AI categories
- **Prompt security**: Enable prompt security checks
- **Generative model selection**: Select the model used by generative features
- **Playbook context truncation**: Cull past turns from the playbook prompt
- **Generative Fallback**: Text prompt configuration

**Speech and IVR settings:**
- **Text-to-Speech**: Voice selection with custom voice support
- **Speech-to-Text**: Auto speech adaptation and advanced speech settings

### Speech

Speech features in Dialogflow CX include:

- **Speech models**: Various models for speech recognition and synthesis
- **Voice cloning**: Create custom voices for your agent
- **Speech adaptation**: Adapt speech recognition to your domain
- **Advanced speech settings**: Fine-tune speech behavior
- **Speech model migration**: Migration guides for speech models

### Search

The search feature lets you search, filter, and access the core resources within an agent. You can filter your search results by:

- Flows
- Pages
- Intents
- Entity types
- Route groups
- Webhooks
- Generators

**To search for a resource:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your GCP project
3. Select your agent
4. Click the search icon in the top menu bar
5. Enter the keyword for the resource you are searching for
6. Optionally filter the results by type of resource from the dropdown menu

**Advanced search options:**
- Select a type of resource to filter by
- Under **Reference Filters**, select the **AND** or **OR** matching rule
- Add rules to search for resources by other resources they reference, or by their properties

### Integrations

Conversational Agents (Dialogflow CX) provides several built-in integrations with other conversation platforms. These integrations provide a user interface to the end-user, and they call the API for you.

#### Partner Telephony Integrations

These telephony integrations are created by Google partners in collaboration with Google:

- **AudioCodes**
- **Avaya**
- **Twilio**
- **Voximplant**

#### Conversational Agents (Dialogflow CX) Built-in Integrations

These integrations are fully supported by Conversational Agents (Dialogflow CX):

- **Dialogflow CX Phone Gateway**
- **Dialogflow CX Messenger**
- **Messenger from Meta**
- **Workplace from Meta**
- **LINE**
- **Slack**
- **Google Chat**

#### Google-Contributed Open Source Integrations

These open source integrations were contributed by Google:

- **Azure Bot Service & Microsoft Teams**
- **Discord**
- **Google Chat**
- **ServiceNow**
- **Slack**
- **Spark**
- **Telegram**
- **Twilio**
- **Twitter**
- **Viber**

#### Avatar Integrations

- **Soul Machines**

#### Independent Integrations

These integrations are not built-in and are created by other organizations and individuals.

### Multilingual Agents

Dialogflow supports many languages. The language you choose when creating an agent is set as the default language, and you can add additional languages.

#### Root and Locale-Specific Languages

There are two categories of languages:

- **Root languages**: Languages like _English (en)_ that do not specify a locale
- **Locale-specific languages**: Languages like _English-US (en-US)_ that do specify a locale as a specific region or country

#### Add a Language

To add a language or locale with the Dialogflow CX console:

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose the Google Cloud project for the agent
3. Find the agent in the list
4. Click the agent display name
5. Click **Agent Settings**
6. Click the **Languages** tab
7. Add or remove languages as needed
8. Click **Save**

#### Language-Specific Data

Most agent data is common for all languages of a multilingual agent. However, text used to interact with an end-user is language-specific:

- [intent training phrases](https://cloud.google.com/dialogflow/cx/docs/concept/intent#tp)
- [fulfillment responses](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment#static)
- [entity entries](https://cloud.google.com/dialogflow/cx/docs/concept/entity-options)

#### AI Generate Language-Specific Data

Conversational Agents (Dialogflow CX) gives you the option to speed up the process of adding language-specific data by using AI generation:

- **Intent AI generation**: Auto-generate training phrases in a non-default language
- **Entity AI generation**: Auto-generate and auto-translate reference values and synonyms
- **Fulfillment AI generation**: Auto-translate agent responses

#### Language Auto Detection

If the end-user's query language differs from the language specified in the request, Dialogflow can detect it and automatically switch to the end-user's language.

### Call Companion

Call companion provides an interactive visual interface that end-users can access on their mobile phone during a voice call with your agent. This visual interface is meant to supplement the call, not replace it.

**Features:**
- Text input
- Image display
- Real-time call transcript viewing
- Interactive elements like clickable chips

**Limitations:**
- Only works with [Dialogflow CX Phone Gateway](https://cloud.google.com/dialogflow/cx/docs/concept/integration/phone-gateway)
- Single phone number provisioned for built-in SMS feature
- Built-in SMS phone number can send SMS only to US phone numbers
- Supports text input, clickable chips and image output only
- Maximum 1000 concurrent calls using call companion for a single project
- Does not work with VPC-SC by default

**Setup:**
1. Go to the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Go to **Agent Settings** > **Multimodal** and enable **Conversation History**
5. Select the **Manage** tab
6. Click **Integrations** in the left sidebar menu
7. Enable call companion for Dialogflow CX Phone Gateway
8. Configure call companion settings

### Best Practices

This guide provides best practices for using the Dialogflow service:

#### Productionization

Before running your agent in production:

- **Use agent versions**: Always use agent versions for your production traffic
- **Reuse session clients**: Improve performance by reusing `*Client` client library instances
- **Implement error handling with retries**: Handle API errors with exponential backoff

#### Agent Versions

You should always use agent versions for your production traffic. See [Versions and environments](https://cloud.google.com/dialogflow/cx/docs/concept/version) for details.

#### Create Agent Backup

Keep an up-to-date [exported](https://cloud.google.com/dialogflow/cx/docs/concept/agent#export) agent backup. This will allow you to quickly recover if you accidentally delete the agent or the project.

#### Client Reuse

You can improve the performance of your application by reusing `*Client` client library instances for the duration of your application's execution lifetime.

#### API Error Retries

When calling API methods, you may receive error responses. There are some errors which should be retried, because they are often due to transient issues:

- **Cloud API errors**: If you are using a Google supplied client library, Cloud API error retries with exponential backoff are implemented for you
- **Webhook errors**: Your code should retry `503 Service Unavailable` errors received from your webhook

#### Load Testing

It is a best practice to execute load testing for your system before you release code to production:

- **Ramp up load**: Your load test must ramp up the load applied to the Dialogflow service
- **API calls are charged**: You will be charged for API calls during a test
- **Use test doubles**: You may not need to call the API during your load test
- **Use retries**: Your load test must perform retries with a backoff

#### Calling Dialogflow Securely from an End-User Device

You should never store your private keys used to access the Dialogflow API on an end-user device. When your client application needs to call the Dialogflow API, it should send requests to a developer-owned proxy service on a secure platform.

#### Performance

Understanding latency is important for designing responsive agents and setting realistic performance expectations:

- **Flow actions: state handlers**: Fastest operation
- **Flows: intent detection (text)**: Fastest operation
- **Flows: parameter detection (text)**: Fast operation
- **Speech recognition (streaming)**: Data is processed and responses are returned as soon as possible
- **Speech synthesis (streaming)**: Data is processed and responses are returned as quickly as possible
- **Data stores: generative AI disabled**: Actual time depends on the size of the data store
- **Data stores: generative AI enabled**: Performance depends on the size of the data store, the language model in use, and the length of the prompt output and input
- **Generative fallback**: Performance depends on the language in use and the prompt output and input length
- **Generators**: Performance depends on the language model in use, the complexity of the prompt input and output length, and the number of generators in the turn
- **Playbooks execution**: Performance depends on the complexity of the playbook, the number of prompts, and the execution time of any tools called
- **Webhook calls**: Performance is directly determined by the execution time of your code in the webhook

### Logging and History

#### Cloud Logging

Dialogflow API requests and responses can optionally be logged to [Cloud logging](https://cloud.google.com/logging/docs) for your agent.

**Enable Cloud logging:**
To enable or disable Cloud logging for your agent, see the logging options in the [agent's general settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent#settings-general).

**Viewing Cloud logs:**
Once you enable Cloud logging for an agent, you can browse these logs using the [Cloud Logs Explorer](https://cloud.google.com/logging/docs/view/logs-explorer-interface).

**Log format:**
The following is a partial list of log entry titles used by Dialogflow:

- Dialogflow Request
- Dialogflow Response
- Dialogflow webhook request
- Dialogflow webhook response
- Dialogflow webhook error

**Regionalization:**
By default, Dialogflow Cloud log entries are routed to the [\_Default logs bucket](https://cloud.google.com/logging/docs/buckets), which is global. If you have data residency requirements for your project, you can route your logs to a region-specific logs bucket.

**Limitations:**
- If Dialogflow response exceeds the Cloud logging log entry size [limit](https://cloud.google.com/logging/quotas), the `QueryResult.diagnosticInfo` field is not included in the logs
- At most 500 turns will be logged for each conversation

### Security and Data Residency

#### Security Settings

Security settings are used to configure data redaction and data retention. These settings control how data is redacted in [Cloud logging](https://cloud.google.com/dialogflow/cx/docs/concept/logging) and interaction logging used by [Conversation history](https://cloud.google.com/dialogflow/cx/docs/concept/conversation-history).

**Security settings:**
- **redaction_strategy**: Strategy used for redaction
- **redaction_scope**: The data redaction is applied to
- **inspect_template**: [DLP](https://cloud.google.com/sensitive-data-protection/docs) inspect template name
- **deidentify_template**: [DLP](https://cloud.google.com/sensitive-data-protection/docs) deidentify template name
- **purge_data_types**: Data to remove when a data retention purge is triggered
- **retention_window_days**: Number of days that data is retained

**Create a security settings resource:**
1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click **Agent Settings**
5. Click the **Security** tab
6. Click **Manage Security Settings**
7. Click **Create Security Settings**
8. Enter security settings configuration
9. Click **Create**

### Testing

Testing is an important part of developing and maintaining Dialogflow CX agents. The platform provides various testing tools and capabilities to ensure your agent works correctly.

### Conversation Profiles

Conversation profiles provide some important characteristics about conversations between end-users and agents. They can be created in conjunction with either [Dialogflow CX Phone Gateway integration](https://cloud.google.com/dialogflow/cx/docs/concept/integration/phone-gateway) or [Agent Assist](https://cloud.google.com/agent-assist/docs/conversation-profile).

**Create a conversation profile:**
The following fields are required to create a new conversation profile:

- **Display name**: Display name for the conversation profile
- **Language**: Language for the conversation profile
- **Enable Call companion**: Enable this to use call companion for Dialogflow CX Phone Gateway

**Agent linking:**
To link a conversation profile to an agent:

1. Select the conversation profile
2. Click **Link with agent**
3. Select the agent
4. Click **Select**
5. Click **Save**

### Training

When your agent is trained, Conversational Agents (Dialogflow CX) uses your training data to build machine learning models specifically for your agent. Each flow of your agent has its own model.

**Draft flow automatic training:**
[ML settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-ml) lets you select either a **Standard NLU** or **Advanced NLU** NLU type. A setting to enable or disable automatic training is available.

**Draft flow manual training:**
To manually train a flow from the console, click the **Train NLU** button in the [ML settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings#settings-ml).

**Flow version automatic training:**
Whenever a new [flow version](https://cloud.google.com/dialogflow/cx/docs/concept/version) is created, the new flow version is automatically trained.

### Sessions

A session represents a conversation between a Conversational Agents (Dialogflow CX) agent and an end-user. You create a session at the beginning of a conversation and use it for each turn of the conversation.

**Session characteristics:**
- Each session is determined unique by a session ID generated by your system
- A session remains active and its data is stored for 30 minutes after the last request is sent for the session
- You should not use the same session for concurrent conversations with different end-users

**Long-lasting sessions:**
By default, Conversational Agents (Dialogflow CX) maintains the session data for 30 minutes. There are two ways to extend the lifetime of the sessions:

- **(Preferred)** Set session TTL using `QueryParameters.session_ttl`. The maximum allowed value is 24 hours
- You can revive the previous session state by setting `QueryParameters.current_page` and `QueryParameters.parameters` in `DetectIntentRequest`

### Git Export/Restore

Conversational Agents (Dialogflow CX) integrates with multiple Git providers (GitHub, Gitlab, Bitbucket, and others). This integration makes it easy to [export your agent to JSON](https://cloud.google.com/dialogflow/cx/docs/reference/json-export) for a push to a Git provider, and to pull from a Git provider for an [agent restore](https://cloud.google.com/dialogflow/cx/docs/concept/agent#export).

**Configuration:**
To configure this feature, you need to acquire an access token from your Git provider, store it in Secret Manager, and provide the secret resource to Conversational Agents (Dialogflow CX).

**Push and restore:**
- The **Push** button is used to export your agent and make a commit to the Git branch selected in the Git branch dropdown
- The **Restore** button is used to pull your agent data from the Git branch selected in the Git branch drop-down and restore your Conversational Agents (Dialogflow CX) agent from this data

### Sentiment

Sentiment analysis inspects end-user input and identifies the prevailing subjective opinion, especially to determine an end-user's attitude as positive, negative, or neutral.

**Supported languages:**
For a list of supported languages, see the **sentiment** column on the [language reference](https://cloud.google.com/dialogflow/cx/docs/reference/language).

**Detect intent:**
Using the API, you can request sentiment analysis for each `detectIntent` or `streamingDetectIntent` call by setting the `analyzeQueryTextSentiment` field to true.

**Using sentiment in conditions:**
You can use sentiment analysis results via the request-scoped parameters when defining a condition.

### Using Multiple Projects

In some cases, you might need to create multiple Google Cloud projects to use Dialogflow:

- You might find it useful to create one project for authentication, quotas, and billing, and additional projects for [agent](https://cloud.google.com/dialogflow/es/docs/agents-overview) data

**Consumer and resource projects:**
- **Consumer project**: The project associated with the service account you provide for an API call
- **Resource project**: The project associated with the agent's project

### Versions and Environments

You can create multiple versions of your agent flows, [playbooks](https://cloud.google.com/dialogflow/cx/docs/concept/playbook) and tools and deploy them to separate serving environments.

**Production traffic best practices:**
- **Always use versions for production traffic**: A draft is updated every time a developer on your team makes a change
- **Always use environment-specific webhooks**: When making updates to your agent, you often have interdependent updates to your webhook code
- **Consider possible agent errors while changing versions**: If you change a version in your production environment while sessions are active, it may cause agent errors for some active sessions

**Manage versions:**
To manage your versions:

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click the **Shared Resources** tab
5. Click **Versions**
6. The agent flows are listed. Select one
7. The versions are listed for the selected flow

**Manage environments:**
To manage your agent environments:

1. Open the [Dialogflow CX console](https://dialogflow.cloud.google.com/cx/projects)
2. Choose your Google Cloud project
3. Select your agent
4. Click the **Shared Resources** tab
5. Click **Environments**
6. The agent environments are listed

### Data Application Levels

Conversational Agents (Dialogflow CX) data is applied at different levels, depending on the type of data. For example, NLU settings are applied at the flow version level.

**Levels:**
- **Project**: Applies to all agents, environments, and flow versions in the project
  - [Security settings](https://cloud.google.com/dialogflow/cx/docs/concept/security-settings)
  - [Location settings](https://cloud.google.com/dialogflow/cx/docs/concept/region)
- **Agent**: Applies to all environments and flow versions in the agent
  - All [agent settings](https://cloud.google.com/dialogflow/cx/docs/concept/agent-settings), except [flow-specific settings](https://cloud.google.com/dialogflow/cx/docs/concept/flow#settings)
- **Environment**: None
- **Flow version**: A snapshot of all agent resources (intents, entities, webhooks, and so on), all flow resources (pages), and all [flow settings](https://cloud.google.com/dialogflow/cx/docs/concept/flow#settings)

---

## How-to Guides

### Migrating from Dialogflow ES to Conversational Agents (Dialogflow CX)

Conversational Agents (Dialogflow CX) agents provide you with [more powerful conversation controls and tools](https://cloud.google.com/dialogflow/docs/editions#agent-types) than Dialogflow ES agents. If your Dialogflow ES agent handles complex conversations, you should consider migrating to Conversational Agents (Dialogflow CX).

This guide describes how to migrate an agent from Dialogflow Dialogflow ES to Conversational Agents (Dialogflow CX). These two agent types have many fundamental differences, so there is no straightforward way to perform this migration.

#### Key Differences Between Dialogflow ES and Conversational Agents (Dialogflow CX)

**Structure and conversation path control:**
- **Dialogflow ES**: Uses intents as building blocks and context for conversation control
- **Conversational Agents (Dialogflow CX)**: Uses pages as graph nodes, flows to group related pages, and state handlers for precise conversation control

**Form filling:**
- **Dialogflow ES**: Uses slot filling with required parameters
- **Conversational Agents (Dialogflow CX)**: Uses form filling with page-associated parameters and condition routes

**Transitions:**
- **Dialogflow ES**: Automatic transitions based on intent matching
- **Conversational Agents (Dialogflow CX)**: Controlled transitions using state handlers with various trigger conditions

**Agent responses:**
- **Dialogflow ES**: Responses sent when intents are matched
- **Conversational Agents (Dialogflow CX)**: Responses controlled by fulfillment, with support for response queues

**Parameters:**
- **Dialogflow ES**: Parameters defined only in intents with basic reference format
- **Conversational Agents (Dialogflow CX)**: Parameters defined in intents and page forms, propagated to session parameters

**Webhooks:**
- **Dialogflow ES**: Single webhook service per agent
- **Conversational Agents (Dialogflow CX)**: Multiple webhook services with built-in error handling

#### Migration Process

The recommended process is an automated/manual hybrid process:

1. Use a migration tool that reads Dialogflow ES agent data and writes it to your Conversational Agents (Dialogflow CX) agent
2. The tool captures a TODO list of items that must be manually migrated
3. Re-create your complete Conversational Agents (Dialogflow CX) agent using best practices, the TODO list, and the migrated data

#### Migration Tool

The migration tool copies custom entity types and intent training phrases from Dialogflow ES to Conversational Agents (Dialogflow CX). It generates a TODO list for manual migration of other features.

**Tool limitations:**
- Does not support mega agents (multiple sub-agents)
- Does not support multilingual agents
- System entity verification assumes English language and US region

### Detect Intent

There are basic samples that show how to detect intent in the [quickstart](https://cloud.google.com/dialogflow/cx/docs/quick/api#detect-intent). This guide provides additional samples for advanced scenarios:

- **Detect intent with audio input**: Samples for audio-based intent detection
- **Detect intent with event invocation**: Samples for event-triggered intent detection
- **Detect intent with caller-triggered intent match**: Samples for caller-triggered scenarios
- **Detect intent with sentiment analysis enabled**: Samples with sentiment analysis
- **Detect intent with text-to-speech response**: Samples with TTS responses
- **Detect intent with webhook disabled**: Samples without webhook calls
- **Streaming detect intent with audio file input**: Samples for streaming audio
- **Streaming detect intent with microphone audio**: Real-time streaming audio interface
- **Streaming detect intent with partial response enabled**: Samples with partial responses

### Implement Webhooks

This guide provides various samples for implementing [webhooks](https://cloud.google.com/dialogflow/cx/docs/concept/webhook) as well as webhook troubleshooting recommendations.

**Webhook samples:**
- **Set a session parameter**: How to set session parameters from webhooks
- **Return a fulfillment response**: How to return fulfillment responses
- **Set form parameters as required**: How to flag parameters as required
- **Validate a form parameter**: How to validate form parameters
- **Log session ID**: How to log session IDs from webhook requests

**Troubleshooting:**
- **Life of a webhook call**: Understanding webhook call flow
- **Useful logs for debugging webhooks**: Key logs for debugging
- **Common webhook issues**: DNS errors, client-side errors, timeouts, unreachable servers
- **Tracing webhook calls**: How to correlate Dialogflow and webhook server logs

### Manage Agents with the API

Normally, you create and delete agents using the console. However, in certain advanced scenarios, you may find it easier to use the API.

**Create an agent:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples
- Required fields: displayName, defaultLanguageCode, timeZone

**Delete an agent:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples

### Manage Pages with the API

In most cases, you will use the console to manage pages. In advanced scenarios, you may wish to use the API to manage pages.

**Create page:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples
- Required fields and configuration options

**List pages:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples
- Filtering and pagination options

**Delete pages:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples

### Manage Intents with the API

Normally, you create and delete intents using the console. However, in certain advanced scenarios, you may find it easier to use the API.

**Create an intent:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples
- Required fields: displayName

**Update an intent:**
- Use the [field mask guide](https://cloud.google.com/dialogflow/cx/docs/how/field-mask) for updating individual fields

**Delete an intent:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples

### Update Data with a FieldMask

When updating agent data with the API, you can choose to overwrite the entire data type or to overwrite only specific fields of the data type. It is usually best to overwrite specific fields to avoid accidentally overwriting all of your data.

**FieldMask examples:**
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples
- Updating display name for Intent type
- Using updateMask parameter in requests

### List Data with a Filter

When listing data with the API, some list method requests provide a `filter` field. You can use these filters to only return results you are interested in.

**Filter examples:**
- Java, Node.js, and Python examples
- Filtering test case results by environment
- Using filter parameter in list requests

### Long-running Operations

Some methods of the Conversational Agents (Dialogflow CX) API return a long-running operation. These methods are asynchronous, and the operation may not be completed when the method returns a response.

**Operation management:**
- Check operation status
- Wait for completion
- Cancel operations
- REST API examples with curl and PowerShell
- Java, Node.js, and Python examples

## Tutorials & Samples

### Other Samples and Learning Material

The Dialogflow CX documentation provides various samples and learning materials to help you get started and master the platform:

- **Code samples**: Practical examples for common use cases
- **Tutorials**: Step-by-step guides for building agents
- **Learning materials**: Additional resources for understanding concepts
- **Best practices**: Guidelines for optimal agent design
- **Integration examples**: Samples for various platform integrations

These resources are available in multiple programming languages including Java, Node.js, Python, and more, making it easy to find examples that match your preferred development environment.

---

## References

- [Google Cloud Dialogflow CX Documentation](https://cloud.google.com/dialogflow/cx/docs/)
- [Conversational Agents Console](https://conversational-agents.cloud.google.com/)
- [Dialogflow CX Console](https://dialogflow.cloud.google.com/cx/projects)
- [AI Applications Console](https://console.cloud.google.com/gen-app-builder/)
